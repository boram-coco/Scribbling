<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Scribbling – czech-banking-customer-trans-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Scribbling</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../about.html" aria-current="page">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Posts</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/학회.html" class="sidebar-item-text sidebar-link">2023년 학회 발표 준비</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/논문.html" class="sidebar-item-text sidebar-link">GNN</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/TS8.html" class="sidebar-item-text sidebar-link">TS HW8</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Hadamangeo</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/hadamangeo/graph4-3.html" class="sidebar-item-text sidebar-link">CH4. 지도 그래프 학습(그래프 정규화 방법)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/hadamangeo/Czech-banking-customer-trans-analysis.html" class="sidebar-item-text sidebar-link active">Czech Bank’s Financial Data Analysis. Moving from gut feeling to data-driven decisions.</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/hadamangeo/Hands-on Graph Neural Networks with PyTorch &amp; PyTorch Geometric.html" class="sidebar-item-text sidebar-link">Hands-on Graph Neural Networks with PyTorch &amp; PyTorch Geometric</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/hadamangeo/VAE.html" class="sidebar-item-text sidebar-link">VAE(-ing)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/hadamangeo/coin prediction.html" class="sidebar-item-text sidebar-link">미래 예측 데이터 분석(비트코인 시세 예측)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/hadamangeo/ml with python 8.html" class="sidebar-item-text sidebar-link">지도 학습</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">사기거래</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/graph8(frac.html" class="sidebar-item-text sidebar-link">CH8. 신용카드 거래에 대한 그래프 분석(frac=0.3)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/낙서.html" class="sidebar-item-text sidebar-link">낙서</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/교수님.html" class="sidebar-item-text sidebar-link">분석</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/사기거래 날짜 230602.html" class="sidebar-item-text sidebar-link">사기거래 날짜 wmatrix</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/교수님 data(re).html" class="sidebar-item-text sidebar-link">사기거래 변형코드</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/2023-05-24-try2변형.html" class="sidebar-item-text sidebar-link">사기거래(교수님 코드-변형)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/교수님 data(원본).html" class="sidebar-item-text sidebar-link">사기거래(교수님)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/9999.html" class="sidebar-item-text sidebar-link">사기거래(교수님과 같이 정리중)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/사기거래/교수님 data(time12).html" class="sidebar-item-text sidebar-link">사기거래(설명변수 time추가)</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#czech-banks-financial-data-analysis.-moving-from-gut-feeling-to-data-driven-decisions." id="toc-czech-banks-financial-data-analysis.-moving-from-gut-feeling-to-data-driven-decisions." class="nav-link active" data-scroll-target="#czech-banks-financial-data-analysis.-moving-from-gut-feeling-to-data-driven-decisions.">Czech Bank’s Financial Data Analysis. Moving from gut feeling to data-driven decisions.</a>
  <ul class="collapse">
  <li><a href="#datasets-structure" id="toc-datasets-structure" class="nav-link" data-scroll-target="#datasets-structure">Datasets structure</a>
  <ul class="collapse">
  <li><a href="#business-questions-part-1---customer-insight" id="toc-business-questions-part-1---customer-insight" class="nav-link" data-scroll-target="#business-questions-part-1---customer-insight">Business questions part #1 - Customer insight</a></li>
  <li><a href="#business-questions-part-1-conclusion" id="toc-business-questions-part-1-conclusion" class="nav-link" data-scroll-target="#business-questions-part-1-conclusion">Business questions part #1 conclusion:</a></li>
  <li><a href="#business-questions-part-2---card-products-patterns" id="toc-business-questions-part-2---card-products-patterns" class="nav-link" data-scroll-target="#business-questions-part-2---card-products-patterns">Business questions part #2 - Card products’ patterns</a></li>
  <li><a href="#business-questions-part-2-conclusion" id="toc-business-questions-part-2-conclusion" class="nav-link" data-scroll-target="#business-questions-part-2-conclusion">Business questions part #2 conclusion:</a></li>
  <li><a href="#business-questions-part-3-loans-insight" id="toc-business-questions-part-3-loans-insight" class="nav-link" data-scroll-target="#business-questions-part-3-loans-insight">Business questions part #3: loans insight</a></li>
  <li><a href="#business-questions-part-3-loans-insight-conclusion" id="toc-business-questions-part-3-loans-insight-conclusion" class="nav-link" data-scroll-target="#business-questions-part-3-loans-insight-conclusion">Business questions part #3 (loans insight) conclusion:</a></li>
  <li><a href="#business-questions-part-4-transactions" id="toc-business-questions-part-4-transactions" class="nav-link" data-scroll-target="#business-questions-part-4-transactions">Business questions part #4: transactions</a></li>
  <li><a href="#business-questions-part-4-transactions-conclusion" id="toc-business-questions-part-4-transactions-conclusion" class="nav-link" data-scroll-target="#business-questions-part-4-transactions-conclusion">Business questions part #4 (transactions) conclusion:</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="czech-banks-financial-data-analysis.-moving-from-gut-feeling-to-data-driven-decisions." class="level1">
<h1>Czech Bank’s Financial Data Analysis. Moving from gut feeling to data-driven decisions.</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="czech.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Czech</figcaption><p></p>
</figure>
</div>
<section id="datasets-structure" class="level2">
<h2 class="anchored" data-anchor-id="datasets-structure">Datasets structure</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://view.dwcontent.com/file_view/lpetrocelli/czech-financial-dataset-real-anonymized-transactions/data%20map.gif?auth=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwcm9kLXVzZXItY2xpZW50OnRhbGdhdCIsImlzcyI6ImFnZW50OnRhbGdhdDo6ZGRkNjczOGItMjE3My00ZjJmLWJlMzctOTIxNTU2MzgyYWNhIiwiaWF0IjoxNTQ5MjcyMzc5LCJyb2xlIjpbInVzZXIiLCJ1c2VyX2FwaV9hZG1pbiIsInVzZXJfYXBpX3JlYWQiLCJ1c2VyX2FwaV93cml0ZSJdLCJnZW5lcmFsLXB1cnBvc2UiOmZhbHNlLCJ1cmwiOiJlYjA3MWQ2ODY4N2Y3NmY4NzM0ZGUzM2MzZjk3MTIzNDgxOWYwZTBjIn0.1bYEPgFwBlTGWf40nJzSdDyDJbi7YYqPJ-K-yeYOZ7SSc8rkMSc-ubQFbRoFZiQrhvoHpgzyq_mvON_Xo7MQBA" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">data map.gif</figcaption><p></p>
</figure>
</div>
<p>Thanks to TSilveira for data visualization examples: https://www.kaggle.com/tsilveira/applying-heatmaps-for-categorical-data-analysis</p>
<div class="cell" data-execution_count="709">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># </span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># </span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7"></a>color <span class="op">=</span> sns.color_palette()</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="im">from</span> plotly <span class="im">import</span> tools</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="im">import</span> plotly.offline <span class="im">as</span> py</span>
<span id="cb1-15"><a href="#cb1-15"></a>py.init_notebook_mode(connected<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="im">import</span> plotly.graph_objs <span class="im">as</span> go</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="im">import</span> os</span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="bu">print</span>(os.listdir(<span class="st">"../czech-banking-fin-analysis"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script><script type="text/javascript">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script><script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window._Plotly) {require(['plotly'],function(plotly) {window._Plotly=plotly;});}</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>['.git', '.ipynb_checkpoints', 'account.csv', 'card.csv', 'client.csv', 'Czech-banking-customer-trans-analysis.ipynb', 'czech.jpg', 'Data dictionary.pdf', 'disp.csv', 'district.csv', 'loan.csv', 'order.csv', 'Plots', 'trans.csv']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="710">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">#defining all necessary functions</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">def</span> date_correction (df, col_name):</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="co">""" Function that will re-format cells into date format. Input should be in the format of YYMMDD, e.g. 950107</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">    input: dataframe and column name of the dataframe</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">    output: updated dataframe</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">    """</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>    df [col_name] <span class="op">=</span> pd.to_datetime (df [col_name], <span class="bu">format</span> <span class="op">=</span> <span class="st">'%y%m</span><span class="sc">%d</span><span class="st">'</span>, errors <span class="op">=</span> <span class="st">'coerce'</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="cf">return</span> df</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="kw">def</span> date_misinterp_cor (date): <span class="co">#correction of date misinterpretation when 45 treated as 2045 and not 1945</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="co">"""Function that corrects year misinterpretation when 45 treated as 2045 and not 1945</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">    input: date</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">    output: corrected date"""</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="cf">if</span> date.year <span class="op">&gt;</span> <span class="dv">2000</span>: </span>
<span id="cb3-16"><a href="#cb3-16"></a>        date <span class="op">=</span> date.replace (year <span class="op">=</span> date.year <span class="op">-</span> <span class="dv">100</span>)</span>
<span id="cb3-17"><a href="#cb3-17"></a>        <span class="cf">return</span> date</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="cf">else</span>:</span>
<span id="cb3-19"><a href="#cb3-19"></a>        <span class="cf">return</span> date</span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="kw">def</span> calculate_age (born_date):</span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="co">"""Age calculation as of 31.12.1998 </span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">    input: born date</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">    outpute: age (int)"""</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>    born <span class="op">=</span> born_date.year</span>
<span id="cb3-26"><a href="#cb3-26"></a>    <span class="cf">return</span> <span class="dv">1998</span> <span class="op">-</span> born</span>
<span id="cb3-27"><a href="#cb3-27"></a></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="kw">def</span> date_parsing (date):</span>
<span id="cb3-29"><a href="#cb3-29"></a>    <span class="co">"""Extracting year from a string. </span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">    input: a value that contains date in the first 6 symbols.</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">    output: year"""</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>    date <span class="op">=</span> <span class="bu">int</span> (<span class="bu">str</span> (date) [<span class="dv">0</span>:<span class="dv">6</span>])</span>
<span id="cb3-33"><a href="#cb3-33"></a>    date2 <span class="op">=</span> pd.to_datetime (date, <span class="bu">format</span> <span class="op">=</span> <span class="st">'%y%m</span><span class="sc">%d</span><span class="st">'</span>, errors <span class="op">=</span> <span class="st">'coerce'</span>)</span>
<span id="cb3-34"><a href="#cb3-34"></a>    <span class="cf">if</span> date2.year <span class="op">&gt;</span> <span class="dv">2000</span>: </span>
<span id="cb3-35"><a href="#cb3-35"></a>        <span class="cf">return</span> date2.year <span class="op">-</span> <span class="dv">100</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>    <span class="cf">else</span>:</span>
<span id="cb3-37"><a href="#cb3-37"></a>        <span class="cf">return</span> date2.year</span>
<span id="cb3-38"><a href="#cb3-38"></a>    </span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="kw">def</span> year_extract (date):</span>
<span id="cb3-40"><a href="#cb3-40"></a>    <span class="co">""" Function that will extract a year from date and return it</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="co">        input should be date format"""</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>    <span class="cf">if</span> date.year <span class="op">&gt;</span> <span class="dv">2000</span>: </span>
<span id="cb3-43"><a href="#cb3-43"></a>        <span class="cf">return</span> date.year <span class="op">-</span> <span class="dv">100</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>    <span class="cf">else</span>:</span>
<span id="cb3-45"><a href="#cb3-45"></a>        <span class="cf">return</span> date.year</span>
<span id="cb3-46"><a href="#cb3-46"></a>    </span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="kw">def</span> df_row_normalize(dataframe):</span>
<span id="cb3-48"><a href="#cb3-48"></a>    <span class="co">'''Normalizes the values of a given pandas.Dataframe by the total sum of each line.</span></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="co">    Algorithm based on https://stackoverflow.com/questions/26537878/pandas-sum-across-columns-and-divide-each-cell-from-that-value'''</span></span>
<span id="cb3-50"><a href="#cb3-50"></a>    <span class="cf">return</span> dataframe.div(dataframe.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="711">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#loading all the datasets</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>accounts_df <span class="op">=</span> pd.read_csv (<span class="st">'account.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>cards_df <span class="op">=</span> pd.read_csv (<span class="st">'card.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>clients_df <span class="op">=</span> pd.read_csv (<span class="st">'client.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>dispos_df <span class="op">=</span> pd.read_csv (<span class="st">'disp.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>district_df <span class="op">=</span> pd.read_csv (<span class="st">'district.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a>loan_df <span class="op">=</span> pd.read_csv (<span class="st">'loan.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a>order_df <span class="op">=</span> pd.read_csv (<span class="st">'order.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-10"><a href="#cb4-10"></a>trans_df <span class="op">=</span> pd.read_csv (<span class="st">'trans.csv'</span>, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb4-11"><a href="#cb4-11"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>D:\Users\Kusainov\AppData\Local\Continuum\anaconda3\lib\site-packages\IPython\core\interactiveshell.py:2785: DtypeWarning:

Columns (8) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="712">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">#list of all dataframes</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>files <span class="op">=</span> [accounts_df, cards_df, clients_df, dispos_df, district_df, loan_df, order_df, trans_df]</span>
<span id="cb6-3"><a href="#cb6-3"></a>date_cor_files <span class="op">=</span> [trans_df, accounts_df, loan_df]</span>
<span id="cb6-4"><a href="#cb6-4"></a>files_name <span class="op">=</span> [<span class="st">'accounts_df'</span>, <span class="st">'cards_df'</span>, <span class="st">'clients_df'</span>, <span class="st">'dispos_df'</span>, <span class="st">'district_df'</span>, <span class="st">'loan_df'</span>, <span class="st">'order_df'</span>, <span class="st">'trans_df'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="initial-observations" class="level4">
<h4 class="anchored" data-anchor-id="initial-observations">Initial observations:</h4>
<div class="cell" data-execution_count="713">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#verifying numeric statistics and missing values in the datasets  </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="cf">for</span> <span class="bu">id</span>, item <span class="kw">in</span> <span class="bu">enumerate</span> (files): </span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="bu">print</span> (<span class="st">'Dataframe name: '</span> <span class="op">+</span> <span class="bu">str</span> (files_name [<span class="bu">id</span>]) <span class="op">+</span> <span class="st">" with number of rows:"</span> <span class="op">+</span> <span class="bu">str</span> (item.shape [<span class="dv">0</span>]) <span class="op">+</span> <span class="st">' and columns:'</span> <span class="op">+</span> <span class="bu">str</span> (item.shape [<span class="dv">1</span>]) )</span>
<span id="cb7-4"><a href="#cb7-4"></a>    display (item.describe ())</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="bu">print</span> (item.isnull ().<span class="bu">sum</span> ())</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="bu">print</span> (<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataframe name: accounts_df with number of rows:4500 and columns:4</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>account_id</th>
      <th>district_id</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4500.000000</td>
      <td>4500.000000</td>
      <td>4500.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2786.067556</td>
      <td>37.310444</td>
      <td>951654.608667</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2313.811984</td>
      <td>25.177217</td>
      <td>14842.188377</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>930101.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1182.750000</td>
      <td>13.000000</td>
      <td>931227.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2368.000000</td>
      <td>38.000000</td>
      <td>960102.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3552.250000</td>
      <td>60.000000</td>
      <td>961101.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>11382.000000</td>
      <td>77.000000</td>
      <td>971229.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>account_id     0
district_id    0
frequency      0
date           0
dtype: int64


Dataframe name: cards_df with number of rows:892 and columns:4</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>892.000000</td>
      <td>892.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>480.855381</td>
      <td>3511.862108</td>
    </tr>
    <tr>
      <th>std</th>
      <td>306.933982</td>
      <td>2984.373626</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>229.750000</td>
      <td>1387.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>456.500000</td>
      <td>2938.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>684.250000</td>
      <td>4459.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1247.000000</td>
      <td>13660.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>card_id    0
disp_id    0
type       0
issued     0
dtype: int64


Dataframe name: clients_df with number of rows:5369 and columns:3</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>client_id</th>
      <th>birth_number</th>
      <th>district_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5369.000000</td>
      <td>5369.000000</td>
      <td>5369.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3359.011920</td>
      <td>535114.970013</td>
      <td>37.310114</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2832.911984</td>
      <td>172895.618429</td>
      <td>25.043690</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>110820.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1418.000000</td>
      <td>406009.000000</td>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2839.000000</td>
      <td>540829.000000</td>
      <td>38.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4257.000000</td>
      <td>681013.000000</td>
      <td>60.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>13998.000000</td>
      <td>875927.000000</td>
      <td>77.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>client_id       0
birth_number    0
district_id     0
dtype: int64


Dataframe name: dispos_df with number of rows:5369 and columns:4</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>disp_id</th>
      <th>client_id</th>
      <th>account_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5369.000000</td>
      <td>5369.000000</td>
      <td>5369.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3337.097970</td>
      <td>3359.011920</td>
      <td>2767.496927</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2770.418826</td>
      <td>2832.911984</td>
      <td>2307.843630</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1418.000000</td>
      <td>1418.000000</td>
      <td>1178.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2839.000000</td>
      <td>2839.000000</td>
      <td>2349.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4257.000000</td>
      <td>4257.000000</td>
      <td>3526.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>13690.000000</td>
      <td>13998.000000</td>
      <td>11382.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>disp_id       0
client_id     0
account_id    0
type          0
dtype: int64


Dataframe name: district_df with number of rows:77 and columns:16</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A1</th>
      <th>A4</th>
      <th>A5</th>
      <th>A6</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A13</th>
      <th>A14</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>77.000000</td>
      <td>7.700000e+01</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
      <td>77.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>39.000000</td>
      <td>1.338849e+05</td>
      <td>48.623377</td>
      <td>24.324675</td>
      <td>6.272727</td>
      <td>1.727273</td>
      <td>6.259740</td>
      <td>63.035065</td>
      <td>9031.675325</td>
      <td>3.787013</td>
      <td>116.129870</td>
      <td>5030.831169</td>
    </tr>
    <tr>
      <th>std</th>
      <td>22.371857</td>
      <td>1.369135e+05</td>
      <td>32.741829</td>
      <td>12.780991</td>
      <td>4.015222</td>
      <td>1.008338</td>
      <td>2.435497</td>
      <td>16.221727</td>
      <td>790.202347</td>
      <td>1.908480</td>
      <td>16.608773</td>
      <td>11270.796786</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>4.282100e+04</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>33.900000</td>
      <td>8110.000000</td>
      <td>0.430000</td>
      <td>81.000000</td>
      <td>888.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>20.000000</td>
      <td>8.585200e+04</td>
      <td>22.000000</td>
      <td>16.000000</td>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>5.000000</td>
      <td>51.900000</td>
      <td>8512.000000</td>
      <td>2.310000</td>
      <td>105.000000</td>
      <td>2122.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>39.000000</td>
      <td>1.088710e+05</td>
      <td>49.000000</td>
      <td>25.000000</td>
      <td>6.000000</td>
      <td>2.000000</td>
      <td>6.000000</td>
      <td>59.800000</td>
      <td>8814.000000</td>
      <td>3.600000</td>
      <td>113.000000</td>
      <td>3040.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>58.000000</td>
      <td>1.390120e+05</td>
      <td>71.000000</td>
      <td>32.000000</td>
      <td>8.000000</td>
      <td>2.000000</td>
      <td>8.000000</td>
      <td>73.500000</td>
      <td>9317.000000</td>
      <td>4.790000</td>
      <td>126.000000</td>
      <td>4595.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>77.000000</td>
      <td>1.204953e+06</td>
      <td>151.000000</td>
      <td>70.000000</td>
      <td>20.000000</td>
      <td>5.000000</td>
      <td>11.000000</td>
      <td>100.000000</td>
      <td>12541.000000</td>
      <td>9.400000</td>
      <td>167.000000</td>
      <td>99107.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>A1     0
A2     0
A3     0
A4     0
A5     0
A6     0
A7     0
A8     0
A9     0
A10    0
A11    0
A12    0
A13    0
A14    0
A15    0
A16    0
dtype: int64


Dataframe name: loan_df with number of rows:682 and columns:7</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>682.000000</td>
      <td>682.000000</td>
      <td>682.000000</td>
      <td>682.000000</td>
      <td>682.000000</td>
      <td>682.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>6172.466276</td>
      <td>5824.162757</td>
      <td>963027.910557</td>
      <td>151410.175953</td>
      <td>36.492669</td>
      <td>4190.664223</td>
    </tr>
    <tr>
      <th>std</th>
      <td>682.579279</td>
      <td>3283.512681</td>
      <td>14616.406049</td>
      <td>113372.406310</td>
      <td>17.075219</td>
      <td>2215.830344</td>
    </tr>
    <tr>
      <th>min</th>
      <td>4959.000000</td>
      <td>2.000000</td>
      <td>930705.000000</td>
      <td>4980.000000</td>
      <td>12.000000</td>
      <td>304.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5577.500000</td>
      <td>2967.000000</td>
      <td>950704.500000</td>
      <td>66732.000000</td>
      <td>24.000000</td>
      <td>2477.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>6176.500000</td>
      <td>5738.500000</td>
      <td>970206.500000</td>
      <td>116928.000000</td>
      <td>36.000000</td>
      <td>3934.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6752.500000</td>
      <td>8686.000000</td>
      <td>971212.500000</td>
      <td>210654.000000</td>
      <td>48.000000</td>
      <td>5813.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>7308.000000</td>
      <td>11362.000000</td>
      <td>981208.000000</td>
      <td>590820.000000</td>
      <td>60.000000</td>
      <td>9910.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>loan_id       0
account_id    0
date          0
amount        0
duration      0
payments      0
status        0
dtype: int64


Dataframe name: order_df with number of rows:6471 and columns:6</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>order_id</th>
      <th>account_id</th>
      <th>account_to</th>
      <th>amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6471.000000</td>
      <td>6471.000000</td>
      <td>6.471000e+03</td>
      <td>6471.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>33778.197497</td>
      <td>2962.302890</td>
      <td>4.939904e+07</td>
      <td>3280.635698</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3737.681949</td>
      <td>2518.503228</td>
      <td>2.888356e+07</td>
      <td>2714.475335</td>
    </tr>
    <tr>
      <th>min</th>
      <td>29401.000000</td>
      <td>1.000000</td>
      <td>3.990000e+02</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>31187.500000</td>
      <td>1223.000000</td>
      <td>2.415918e+07</td>
      <td>1241.500000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>32988.000000</td>
      <td>2433.000000</td>
      <td>4.975606e+07</td>
      <td>2596.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>34785.500000</td>
      <td>3645.500000</td>
      <td>7.400045e+07</td>
      <td>4613.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>46338.000000</td>
      <td>11362.000000</td>
      <td>9.999420e+07</td>
      <td>14882.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>order_id      0
account_id    0
bank_to       0
account_to    0
amount        0
k_symbol      0
dtype: int64


Dataframe name: trans_df with number of rows:1056320 and columns:10</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>amount</th>
      <th>balance</th>
      <th>account</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.056320e+06</td>
      <td>1.056320e+06</td>
      <td>1.056320e+06</td>
      <td>1.056320e+06</td>
      <td>1.056320e+06</td>
      <td>2.953890e+05</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.335311e+06</td>
      <td>2.936867e+03</td>
      <td>9.656748e+05</td>
      <td>5.924146e+03</td>
      <td>3.851833e+04</td>
      <td>4.567092e+07</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.227487e+06</td>
      <td>2.477345e+03</td>
      <td>1.394535e+04</td>
      <td>9.522735e+03</td>
      <td>2.211787e+04</td>
      <td>3.066340e+07</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>9.301010e+05</td>
      <td>0.000000e+00</td>
      <td>-4.112570e+04</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.302628e+05</td>
      <td>1.204000e+03</td>
      <td>9.601160e+05</td>
      <td>1.359000e+02</td>
      <td>2.240250e+04</td>
      <td>1.782858e+07</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>8.585065e+05</td>
      <td>2.434000e+03</td>
      <td>9.704100e+05</td>
      <td>2.100000e+03</td>
      <td>3.314340e+04</td>
      <td>4.575095e+07</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.060979e+06</td>
      <td>3.660000e+03</td>
      <td>9.802280e+05</td>
      <td>6.800000e+03</td>
      <td>4.960362e+04</td>
      <td>7.201341e+07</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.682987e+06</td>
      <td>1.138200e+04</td>
      <td>9.812310e+05</td>
      <td>8.740000e+04</td>
      <td>2.096370e+05</td>
      <td>9.999420e+07</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>trans_id           0
account_id         0
date               0
type               0
operation     183114
amount             0
balance            0
k_symbol      481881
bank          782812
account       760931
dtype: int64

</code></pre>
</div>
</div>
<p>From the first sight only transactions dataset contains NaN values for operation, k_symbol, bank and account.</p>
<div class="cell" data-execution_count="714">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">#Dataframes header</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="cf">for</span> <span class="bu">id</span>, item <span class="kw">in</span> <span class="bu">enumerate</span> (files): </span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="bu">print</span> (<span class="st">'Dataframe name:'</span> <span class="op">+</span> <span class="bu">str</span> (files_name [<span class="bu">id</span>]) )</span>
<span id="cb17-4"><a href="#cb17-4"></a>    display (item.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="bu">print</span> (<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataframe name:accounts_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>account_id</th>
      <th>district_id</th>
      <th>frequency</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>576</td>
      <td>55</td>
      <td>POPLATEK MESICNE</td>
      <td>930101</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3818</td>
      <td>74</td>
      <td>POPLATEK MESICNE</td>
      <td>930101</td>
    </tr>
    <tr>
      <th>2</th>
      <td>704</td>
      <td>55</td>
      <td>POPLATEK MESICNE</td>
      <td>930101</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:cards_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
      <th>type</th>
      <th>issued</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1005</td>
      <td>9285</td>
      <td>classic</td>
      <td>931107 00:00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>104</td>
      <td>588</td>
      <td>classic</td>
      <td>940119 00:00:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>747</td>
      <td>4915</td>
      <td>classic</td>
      <td>940205 00:00:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:clients_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>client_id</th>
      <th>birth_number</th>
      <th>district_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>706213</td>
      <td>18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>450204</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>406009</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:dispos_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>disp_id</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>DISPONENT</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:district_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A1</th>
      <th>A2</th>
      <th>A3</th>
      <th>A4</th>
      <th>A5</th>
      <th>A6</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A12</th>
      <th>A13</th>
      <th>A14</th>
      <th>A15</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Hl.m. Praha</td>
      <td>Prague</td>
      <td>1204953</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>100.0</td>
      <td>12541</td>
      <td>0.29</td>
      <td>0.43</td>
      <td>167</td>
      <td>85677</td>
      <td>99107</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Benesov</td>
      <td>central Bohemia</td>
      <td>88884</td>
      <td>80</td>
      <td>26</td>
      <td>6</td>
      <td>2</td>
      <td>5</td>
      <td>46.7</td>
      <td>8507</td>
      <td>1.67</td>
      <td>1.85</td>
      <td>132</td>
      <td>2159</td>
      <td>2674</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Beroun</td>
      <td>central Bohemia</td>
      <td>75232</td>
      <td>55</td>
      <td>26</td>
      <td>4</td>
      <td>1</td>
      <td>5</td>
      <td>41.7</td>
      <td>8980</td>
      <td>1.95</td>
      <td>2.21</td>
      <td>111</td>
      <td>2824</td>
      <td>2813</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:loan_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>930705</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>930711</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>930728</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:order_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>order_id</th>
      <th>account_id</th>
      <th>bank_to</th>
      <th>account_to</th>
      <th>amount</th>
      <th>k_symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29401</td>
      <td>1</td>
      <td>YZ</td>
      <td>87144583</td>
      <td>2452.0</td>
      <td>SIPO</td>
    </tr>
    <tr>
      <th>1</th>
      <td>29402</td>
      <td>2</td>
      <td>ST</td>
      <td>89597016</td>
      <td>3372.7</td>
      <td>UVER</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29403</td>
      <td>2</td>
      <td>QR</td>
      <td>13943797</td>
      <td>7266.0</td>
      <td>SIPO</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

Dataframe name:trans_df</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>695247</td>
      <td>2378</td>
      <td>930101</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171812</td>
      <td>576</td>
      <td>930101</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207264</td>
      <td>704</td>
      <td>930101</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
</div>
<p>Dates in the following dataframes were not loaded as dates:trans_df, accounts_df, cards_df, clients_df (birth date) and loan_df.</p>
<div class="cell" data-execution_count="715">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co">#correcting dates for trans_df, accounts_df, and loan_df. </span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="cf">for</span> <span class="bu">id</span>, item <span class="kw">in</span> <span class="bu">enumerate</span> (date_cor_files): </span>
<span id="cb27-4"><a href="#cb27-4"></a>    date_cor_files [<span class="bu">id</span>] <span class="op">=</span> date_correction (item, <span class="st">'date'</span>)</span>
<span id="cb27-5"><a href="#cb27-5"></a></span>
<span id="cb27-6"><a href="#cb27-6"></a>trans_df <span class="op">=</span> date_cor_files [<span class="dv">0</span>]</span>
<span id="cb27-7"><a href="#cb27-7"></a>accounts_df <span class="op">=</span> date_cor_files [<span class="dv">1</span>]</span>
<span id="cb27-8"><a href="#cb27-8"></a>loans_df <span class="op">=</span> date_cor_files [<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="716">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">#verifying transactions execution dates period in trans_df  </span></span>
<span id="cb28-2"><a href="#cb28-2"></a>trans1 <span class="op">=</span> trans_df.sort_values ([<span class="st">'date'</span>])</span>
<span id="cb28-3"><a href="#cb28-3"></a>display (trans1.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb28-4"><a href="#cb28-4"></a>display (trans1.tail (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1053314</th>
      <td>3631495</td>
      <td>3053</td>
      <td>1998-12-31</td>
      <td>PRIJEM</td>
      <td>NaN</td>
      <td>349.8</td>
      <td>86982.1</td>
      <td>UROK</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1053320</th>
      <td>3632209</td>
      <td>3077</td>
      <td>1998-12-31</td>
      <td>PRIJEM</td>
      <td>NaN</td>
      <td>267.9</td>
      <td>68530.7</td>
      <td>UROK</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1056319</th>
      <td>3626540</td>
      <td>2902</td>
      <td>1998-12-31</td>
      <td>PRIJEM</td>
      <td>NaN</td>
      <td>164.1</td>
      <td>41642.9</td>
      <td>UROK</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From above we can see that transactions given for a period from 1st of Jan 1993 till 31st of Dec 1998</p>
</section>
<section id="business-questions-part-1---customer-insight" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-1---customer-insight">Business questions part #1 - Customer insight</h3>
<ul>
<li>Gender proportion of the bank’s customers.</li>
<li>Age distribution of the bank’s customers.</li>
<li>Clients habitation in different regions of Czech Republic and average salaries of the regions.</li>
<li><strong>Districts that could be attractive for future bank’s market invasion in terms of population, average salary and underrepresented clients base.</strong></li>
</ul>
<p>“Birth number” column should be parced into 3 columns: date of birth, gender and age (as of 31.12.1998)</p>
<p>Initially “Birth number” in the dataset contains both date of birth and gender: the number in the cells is in the form of YYMMDD for men and in the form YYMM+50DD for women, where YYMMDD is the date of birth.</p>
<div class="cell" data-execution_count="717">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">#adding new columns</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>clients_df <span class="op">=</span> clients_df.join (pd.DataFrame ( { <span class="st">'birth_date'</span>: np.nan, <span class="st">'gender'</span>: np.nan, <span class="st">'age'</span>: np.nan}, index <span class="op">=</span> clients_df.index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="718">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">#next step is to fulfill new columns with data from 'birth_number' and 'age'</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>clients_df [<span class="st">'birth_date'</span>] <span class="op">=</span> clients_df [<span class="st">'birth_number'</span>]</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="cf">for</span> ids, item <span class="kw">in</span> <span class="bu">enumerate</span> (clients_df [<span class="st">'birth_number'</span>]):</span>
<span id="cb30-4"><a href="#cb30-4"></a>    <span class="cf">if</span> <span class="bu">int</span> (<span class="bu">str</span> (item) [<span class="dv">2</span>:<span class="dv">4</span>]) <span class="op">&gt;</span> <span class="dv">50</span>:</span>
<span id="cb30-5"><a href="#cb30-5"></a>        clients_df.loc [ids, <span class="st">'gender'</span>] <span class="op">=</span> <span class="dv">0</span> <span class="co">#female</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>        clients_df.loc [ids, <span class="st">'birth_date'</span>] <span class="op">=</span> item <span class="op">-</span> <span class="dv">5000</span> </span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="cf">else</span>: </span>
<span id="cb30-8"><a href="#cb30-8"></a>        clients_df.loc [ids, <span class="st">'gender'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="co">#male #incorrect way is: clients_df.loc [ids] ['gender']         </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="719">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">#converting birth_date into date format</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>clients_df <span class="op">=</span> date_correction (clients_df, <span class="st">'birth_date'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="720">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">#correcting misinterpreted dates</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>clients_df [<span class="st">'birth_date'</span>] <span class="op">=</span> clients_df [<span class="st">'birth_date'</span>].<span class="bu">apply</span> (date_misinterp_cor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="721">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">#calculating age as of on 31.12.1998 </span></span>
<span id="cb33-2"><a href="#cb33-2"></a>clients_df [<span class="st">'age'</span>] <span class="op">=</span> clients_df [<span class="st">'birth_date'</span>].<span class="bu">apply</span> (calculate_age)</span>
<span id="cb33-3"><a href="#cb33-3"></a>display (clients_df.head (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>client_id</th>
      <th>birth_number</th>
      <th>district_id</th>
      <th>birth_date</th>
      <th>gender</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>706213</td>
      <td>18</td>
      <td>1970-12-13</td>
      <td>0.0</td>
      <td>28</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>450204</td>
      <td>1</td>
      <td>1945-02-04</td>
      <td>1.0</td>
      <td>53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>406009</td>
      <td>1</td>
      <td>1940-10-09</td>
      <td>0.0</td>
      <td>58</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="722">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">#plotting customers distribution by age</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>clients_df [<span class="st">'age'</span>].plot (kind <span class="op">=</span> <span class="st">'hist'</span>,</span>
<span id="cb34-3"><a href="#cb34-3"></a>                    title <span class="op">=</span> <span class="st">'Clients distribution per age'</span>,</span>
<span id="cb34-4"><a href="#cb34-4"></a>                   <span class="co"># width = 0.75,</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>                    figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="fl">5.8</span>)</span>
<span id="cb34-6"><a href="#cb34-6"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="722">
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x21d38630&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="723">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">#Clients gender visualization</span></span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>target1 <span class="op">=</span> clients_df [clients_df [<span class="st">'gender'</span>] <span class="op">==</span> <span class="fl">1.0</span>].shape [<span class="dv">0</span>]</span>
<span id="cb36-4"><a href="#cb36-4"></a>target0 <span class="op">=</span> clients_df [clients_df [<span class="st">'gender'</span>] <span class="op">==</span> <span class="fl">0.0</span>].shape [<span class="dv">0</span>]</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a>trace0 <span class="op">=</span> go.Bar (</span>
<span id="cb36-7"><a href="#cb36-7"></a>    x <span class="op">=</span> [<span class="st">'Men'</span>, <span class="st">'Women'</span>],</span>
<span id="cb36-8"><a href="#cb36-8"></a>    y <span class="op">=</span> [target1<span class="op">/</span> (target1 <span class="op">+</span> target0) <span class="op">*</span><span class="dv">100</span>, target0<span class="op">/</span> (target1 <span class="op">+</span> target0) <span class="op">*</span><span class="dv">100</span>], </span>
<span id="cb36-9"><a href="#cb36-9"></a>    marker <span class="op">=</span> <span class="bu">dict</span> (color<span class="op">=</span>[<span class="st">'rgba(34, 167, 240, 1)'</span>, <span class="st">'rgba(222,45,38,0.8)'</span>]</span>
<span id="cb36-10"><a href="#cb36-10"></a>                  ),</span>
<span id="cb36-11"><a href="#cb36-11"></a>) </span>
<span id="cb36-12"><a href="#cb36-12"></a>data <span class="op">=</span> [trace0]</span>
<span id="cb36-13"><a href="#cb36-13"></a>layout <span class="op">=</span> go.Layout (title <span class="op">=</span> <span class="st">'Gender proportion (%)'</span>, autosize<span class="op">=</span> <span class="va">False</span>, width<span class="op">=</span> <span class="dv">500</span>, height<span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb36-14"><a href="#cb36-14"></a>                    )</span>
<span id="cb36-15"><a href="#cb36-15"></a>fig <span class="op">=</span> go.Figure (data<span class="op">=</span>data, layout <span class="op">=</span> layout)</span>
<span id="cb36-16"><a href="#cb36-16"></a><span class="co">#plotly.offline.iplot()</span></span>
<span id="cb36-17"><a href="#cb36-17"></a>py.iplot (fig, filename <span class="op">=</span> <span class="st">'test'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="faa967a2-a864-4dc4-83ed-8d0ab355928b" style="height: 500px; width: 500px;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("faa967a2-a864-4dc4-83ed-8d0ab355928b", [{"marker": {"color": ["rgba(34, 167, 240, 1)", "rgba(222,45,38,0.8)"]}, "x": ["Men", "Women"], "y": [50.73570497299311, 49.264295027006895], "type": "bar", "uid": "f79da4f8-14d1-4b05-a215-cc61a90f47af"}], {"autosize": false, "height": 500, "title": {"text": "Gender proportion (%)"}, "width": 500}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script>
</div>
</div>
<div class="cell" data-execution_count="724">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="bu">print</span> (<span class="st">'Percentage of men: '</span><span class="op">+</span> <span class="bu">str</span> (target1<span class="op">/</span>clients_df.shape [<span class="dv">0</span>]<span class="op">*</span><span class="dv">100</span>) <span class="op">+</span><span class="st">'%'</span> <span class="op">+</span> <span class="st">' percentage of women: '</span> <span class="op">+</span> <span class="bu">str</span> (target0<span class="op">/</span>clients_df.shape [<span class="dv">0</span>]<span class="op">*</span><span class="dv">100</span>) <span class="op">+</span> <span class="st">'%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Percentage of men: 50.73570497299311% percentage of women: 49.264295027006895%</code></pre>
</div>
</div>
<div class="cell" data-execution_count="725">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">#enriching customer info with habitation info   </span></span>
<span id="cb39-2"><a href="#cb39-2"></a>clients_dist_df <span class="op">=</span> clients_df</span>
<span id="cb39-3"><a href="#cb39-3"></a>clients_dist2_df <span class="op">=</span> clients_dist_df.merge (district_df, left_on <span class="op">=</span> <span class="st">'district_id'</span>, right_on <span class="op">=</span> <span class="st">'A1'</span>, </span>
<span id="cb39-4"><a href="#cb39-4"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb39-5"><a href="#cb39-5"></a>display (clients_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb39-6"><a href="#cb39-6"></a>display (clients_dist2_df.head (n<span class="op">=</span><span class="dv">3</span>))      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>client_id</th>
      <th>birth_number</th>
      <th>district_id</th>
      <th>birth_date</th>
      <th>gender</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>706213</td>
      <td>18</td>
      <td>1970-12-13</td>
      <td>0.0</td>
      <td>28</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>450204</td>
      <td>1</td>
      <td>1945-02-04</td>
      <td>1.0</td>
      <td>53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>406009</td>
      <td>1</td>
      <td>1940-10-09</td>
      <td>0.0</td>
      <td>58</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>client_id</th>
      <th>birth_number</th>
      <th>district_id</th>
      <th>birth_date</th>
      <th>gender</th>
      <th>age</th>
      <th>A1</th>
      <th>A2</th>
      <th>A3</th>
      <th>A4</th>
      <th>...</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A12</th>
      <th>A13</th>
      <th>A14</th>
      <th>A15</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>706213</td>
      <td>18</td>
      <td>1970-12-13</td>
      <td>0.0</td>
      <td>28</td>
      <td>18</td>
      <td>Pisek</td>
      <td>south Bohemia</td>
      <td>70699</td>
      <td>...</td>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>65.3</td>
      <td>8968</td>
      <td>2.83</td>
      <td>3.35</td>
      <td>131</td>
      <td>1740</td>
      <td>1910</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>450204</td>
      <td>1</td>
      <td>1945-02-04</td>
      <td>1.0</td>
      <td>53</td>
      <td>1</td>
      <td>Hl.m. Praha</td>
      <td>Prague</td>
      <td>1204953</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>100.0</td>
      <td>12541</td>
      <td>0.29</td>
      <td>0.43</td>
      <td>167</td>
      <td>85677</td>
      <td>99107</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>406009</td>
      <td>1</td>
      <td>1940-10-09</td>
      <td>0.0</td>
      <td>58</td>
      <td>1</td>
      <td>Hl.m. Praha</td>
      <td>Prague</td>
      <td>1204953</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>100.0</td>
      <td>12541</td>
      <td>0.29</td>
      <td>0.43</td>
      <td>167</td>
      <td>85677</td>
      <td>99107</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 22 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="726">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co">#grouping by district ("A2") and population of the district ('A4'), then counting number of customers </span></span>
<span id="cb40-2"><a href="#cb40-2"></a>district_clients_df <span class="op">=</span> pd.DataFrame (clients_dist2_df.groupby ([<span class="st">'A2'</span>, <span class="st">'A4'</span>, <span class="st">'A11'</span>], axis <span class="op">=</span> <span class="dv">0</span>) [<span class="st">'A2'</span>].count ())</span>
<span id="cb40-3"><a href="#cb40-3"></a>district_clients_df.columns <span class="op">=</span> [<span class="st">'count'</span>]</span>
<span id="cb40-4"><a href="#cb40-4"></a></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="co">#making columns out of multi-index of A3 and type_x so to make it easier to operate with values</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>district_clients_df.reset_index (inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="co">#calculating portion of clients in the population of a district</span></span>
<span id="cb40-9"><a href="#cb40-9"></a>district_clients_df [<span class="st">'portion'</span>] <span class="op">=</span> district_clients_df [<span class="st">'count'</span>] <span class="op">/</span> district_clients_df [<span class="st">'A4'</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb40-10"><a href="#cb40-10"></a></span>
<span id="cb40-11"><a href="#cb40-11"></a>display (district_clients_df .head (n<span class="op">=</span><span class="dv">5</span>))</span>
<span id="cb40-12"><a href="#cb40-12"></a>district_clients_df [<span class="st">'count'</span>].<span class="bu">sum</span> ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A2</th>
      <th>A4</th>
      <th>A11</th>
      <th>count</th>
      <th>portion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Benesov</td>
      <td>88884</td>
      <td>8507</td>
      <td>46</td>
      <td>0.051753</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Beroun</td>
      <td>75232</td>
      <td>8980</td>
      <td>63</td>
      <td>0.083741</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Blansko</td>
      <td>107911</td>
      <td>8240</td>
      <td>57</td>
      <td>0.052821</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Breclav</td>
      <td>124605</td>
      <td>8772</td>
      <td>54</td>
      <td>0.043337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brno - mesto</td>
      <td>387570</td>
      <td>9897</td>
      <td>155</td>
      <td>0.039993</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="726">
<pre><code>5369</code></pre>
</div>
</div>
<div class="cell" data-execution_count="727">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="co">#average value of average salaries within districts</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>district_df [<span class="st">'A11'</span>].mean ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="727">
<pre><code>9031.675324675325</code></pre>
</div>
</div>
<div class="cell" data-execution_count="728">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="co">#average value of Relative number of clients comparing to district population</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>district_clients_df [<span class="st">'portion'</span>].mean ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="728">
<pre><code>0.05795326262662295</code></pre>
</div>
</div>
<div class="cell" data-execution_count="729">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="co">#plotting Number of inhabitants vs. Average salary vs. Customers proportion within population of districts</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>district_clients_df2 <span class="op">=</span> district_clients_df.copy ()</span>
<span id="cb46-3"><a href="#cb46-3"></a>district_clients_df2[<span class="st">'A4'</span>] <span class="op">=</span> district_clients_df2[<span class="st">'A4'</span>] <span class="op">/</span> <span class="dv">1000000</span> </span>
<span id="cb46-4"><a href="#cb46-4"></a></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="co">## Initialize the matplotlib figure:</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>fig2, (ax1, ax2, ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">16</span>), sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-7"><a href="#cb46-7"></a>fig2.tight_layout()  <span class="co">#When working with 'tight_layout', the subplot must be adjusted [https://stackoverflow.com/questions/7066121/how-to-set-a-single-main-title-above-all-the-subplots-with-pyplot]</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>fig2.subplots_adjust(top<span class="op">=</span><span class="fl">0.96</span>)  <span class="co">#Adjusting the space for the superior title</span></span>
<span id="cb46-9"><a href="#cb46-9"></a></span>
<span id="cb46-10"><a href="#cb46-10"></a><span class="co">## Plot the District population</span></span>
<span id="cb46-11"><a href="#cb46-11"></a>sns.set_color_codes(<span class="st">"muted"</span>)</span>
<span id="cb46-12"><a href="#cb46-12"></a>sns.barplot(x<span class="op">=</span><span class="st">"A4"</span>, y<span class="op">=</span><span class="st">"A2"</span>, data<span class="op">=</span>district_clients_df2, label <span class="op">=</span> <span class="st">'District population (mln)'</span>,color<span class="op">=</span><span class="st">"b"</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb46-13"><a href="#cb46-13"></a><span class="co">## Add a legend and informative axis label</span></span>
<span id="cb46-14"><a href="#cb46-14"></a>ax1.legend(ncol<span class="op">=</span><span class="dv">2</span>, loc<span class="op">=</span><span class="st">"lower right"</span>, frameon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-15"><a href="#cb46-15"></a>ax1.<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">1.21</span>), ylabel<span class="op">=</span><span class="st">""</span>, xlabel<span class="op">=</span><span class="st">"District population (mln)"</span>)</span>
<span id="cb46-16"><a href="#cb46-16"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>,ax<span class="op">=</span>ax1)</span>
<span id="cb46-17"><a href="#cb46-17"></a></span>
<span id="cb46-18"><a href="#cb46-18"></a><span class="co">## Plot the Average salary</span></span>
<span id="cb46-19"><a href="#cb46-19"></a>sns.set_color_codes(<span class="st">"muted"</span>)</span>
<span id="cb46-20"><a href="#cb46-20"></a>sns.barplot(x<span class="op">=</span><span class="st">"A11"</span>, y<span class="op">=</span><span class="st">"A2"</span>, data<span class="op">=</span>district_clients_df, label<span class="op">=</span><span class="st">"Average salary"</span>, color<span class="op">=</span><span class="st">"b"</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb46-21"><a href="#cb46-21"></a><span class="co">## Add a legend and informative axis label</span></span>
<span id="cb46-22"><a href="#cb46-22"></a>ax2.legend(ncol<span class="op">=</span><span class="dv">2</span>, loc<span class="op">=</span><span class="st">"lower right"</span>, frameon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-23"><a href="#cb46-23"></a>ax2.<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">12541</span>), ylabel<span class="op">=</span><span class="st">""</span>, xlabel<span class="op">=</span><span class="st">"Average salary"</span>)  <span class="co">#The xlim value comes from the maximum value in the dataset.</span></span>
<span id="cb46-24"><a href="#cb46-24"></a>ax2.set_yticklabels([<span class="st">''</span>])</span>
<span id="cb46-25"><a href="#cb46-25"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb46-26"><a href="#cb46-26"></a></span>
<span id="cb46-27"><a href="#cb46-27"></a>sns.set_color_codes(<span class="st">"muted"</span>)</span>
<span id="cb46-28"><a href="#cb46-28"></a>sns.barplot(x<span class="op">=</span><span class="st">"portion"</span>, y<span class="op">=</span><span class="st">"A2"</span>, data<span class="op">=</span>district_clients_df, label<span class="op">=</span><span class="st">"</span><span class="sc">% o</span><span class="st">f clients in population"</span>, color<span class="op">=</span><span class="st">"b"</span>, ax<span class="op">=</span>ax3)</span>
<span id="cb46-29"><a href="#cb46-29"></a><span class="co">## Add a legend and informative axis label</span></span>
<span id="cb46-30"><a href="#cb46-30"></a>ax3.legend(ncol<span class="op">=</span><span class="dv">2</span>, loc<span class="op">=</span><span class="st">"lower right"</span>, frameon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-31"><a href="#cb46-31"></a>ax3.<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.145</span>), ylabel<span class="op">=</span><span class="st">""</span>, xlabel<span class="op">=</span><span class="st">"Relative number of clients comparing to district population (%)"</span>)  <span class="co">#The xlim value comes from the maximum value in the dataset.</span></span>
<span id="cb46-32"><a href="#cb46-32"></a>ax3.set_yticklabels([<span class="st">''</span>])</span>
<span id="cb46-33"><a href="#cb46-33"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax3)</span>
<span id="cb46-34"><a href="#cb46-34"></a></span>
<span id="cb46-35"><a href="#cb46-35"></a>plt.suptitle(<span class="st">'Number of inhabitants vs. Average salary vs. Customers proportion within population of districts'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb46-36"><a href="#cb46-36"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="730">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">#Plotting clients presence in different districts</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>reg_count <span class="op">=</span> Counter (clients_dist2_df [<span class="st">'A2'</span>])</span>
<span id="cb47-3"><a href="#cb47-3"></a>region_counts <span class="op">=</span> pd.DataFrame.from_dict (reg_count, orient <span class="op">=</span> <span class="st">'index'</span>)</span>
<span id="cb47-4"><a href="#cb47-4"></a>region_counts.columns <span class="op">=</span> [<span class="st">'Number of customers'</span>]</span>
<span id="cb47-5"><a href="#cb47-5"></a>region_counts2 <span class="op">=</span> region_counts<span class="co"># / (region_counts ['Percentage_ratio'].sum ()) * 100</span></span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>region_counts2.plot (kind <span class="op">=</span> <span class="st">'barh'</span>,</span>
<span id="cb47-8"><a href="#cb47-8"></a>                    title <span class="op">=</span> <span class="st">'Clients distribution per districts'</span>,</span>
<span id="cb47-9"><a href="#cb47-9"></a>                    width <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span id="cb47-10"><a href="#cb47-10"></a>                    figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">13</span>)</span>
<span id="cb47-11"><a href="#cb47-11"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="730">
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x366260f0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="731">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a><span class="co">#Plotting clients presence in different major regions</span></span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>reg_count <span class="op">=</span> Counter (clients_dist2_df [<span class="st">'A3'</span>])</span>
<span id="cb49-4"><a href="#cb49-4"></a>region_counts <span class="op">=</span> pd.DataFrame.from_dict (reg_count, orient <span class="op">=</span> <span class="st">'index'</span>)</span>
<span id="cb49-5"><a href="#cb49-5"></a>region_counts.columns <span class="op">=</span> [<span class="st">'Percentage_ratio'</span>]</span>
<span id="cb49-6"><a href="#cb49-6"></a>region_counts2 <span class="op">=</span> region_counts <span class="op">/</span> (region_counts [<span class="st">'Percentage_ratio'</span>].<span class="bu">sum</span> ()) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb49-7"><a href="#cb49-7"></a>region_counts2.plot (kind <span class="op">=</span> <span class="st">'bar'</span>,</span>
<span id="cb49-8"><a href="#cb49-8"></a>                    title <span class="op">=</span> <span class="st">'Clients distribution per regions'</span>,</span>
<span id="cb49-9"><a href="#cb49-9"></a>                    width <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span id="cb49-10"><a href="#cb49-10"></a>                    figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="fl">5.8</span>),</span>
<span id="cb49-11"><a href="#cb49-11"></a>                    color <span class="op">=</span> [plt.cm.Paired(np.arange(<span class="bu">len</span>(region_counts)))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="731">
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x18ddceb8&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="732">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a><span class="co">#Average salaries in the regions</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>region_salary_df <span class="op">=</span> pd.DataFrame (district_df.groupby ([<span class="st">'A3'</span>], axis <span class="op">=</span> <span class="dv">0</span>) [<span class="st">'A11'</span>].mean ()).sort_values (<span class="st">'A11'</span>)</span>
<span id="cb51-3"><a href="#cb51-3"></a>display (region_salary_df.head (n<span class="op">=</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A11</th>
    </tr>
    <tr>
      <th>A3</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>east Bohemia</th>
      <td>8611.181818</td>
    </tr>
    <tr>
      <th>south Moravia</th>
      <td>8728.500000</td>
    </tr>
    <tr>
      <th>south Bohemia</th>
      <td>8831.500000</td>
    </tr>
    <tr>
      <th>west Bohemia</th>
      <td>9015.400000</td>
    </tr>
    <tr>
      <th>north Moravia</th>
      <td>9049.181818</td>
    </tr>
    <tr>
      <th>north Bohemia</th>
      <td>9334.200000</td>
    </tr>
    <tr>
      <th>central Bohemia</th>
      <td>9357.250000</td>
    </tr>
    <tr>
      <th>Prague</th>
      <td>12541.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="733">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a><span class="co">#Plotting average salary per regions</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>trace0 <span class="op">=</span> go.Bar (</span>
<span id="cb52-3"><a href="#cb52-3"></a>    x <span class="op">=</span> region_salary_df.index,</span>
<span id="cb52-4"><a href="#cb52-4"></a>    y <span class="op">=</span> region_salary_df [<span class="st">'A11'</span>], </span>
<span id="cb52-5"><a href="#cb52-5"></a>) </span>
<span id="cb52-6"><a href="#cb52-6"></a>data <span class="op">=</span> [trace0]</span>
<span id="cb52-7"><a href="#cb52-7"></a>layout <span class="op">=</span> go.Layout (title <span class="op">=</span> <span class="st">'Average salary per region'</span>, autosize<span class="op">=</span> <span class="va">False</span>, width<span class="op">=</span> <span class="dv">600</span>, height<span class="op">=</span> <span class="dv">400</span>,</span>
<span id="cb52-8"><a href="#cb52-8"></a>                    )</span>
<span id="cb52-9"><a href="#cb52-9"></a>fig <span class="op">=</span> go.Figure (data<span class="op">=</span>data, layout <span class="op">=</span> layout)</span>
<span id="cb52-10"><a href="#cb52-10"></a>py.iplot (fig, filename <span class="op">=</span> <span class="st">'Salaries'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="34895f20-183b-48a3-ba27-9e8b6e738cea" style="height: 400px; width: 600px;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("34895f20-183b-48a3-ba27-9e8b6e738cea", [{"x": ["east Bohemia", "south Moravia", "south Bohemia", "west Bohemia", "north Moravia", "north Bohemia", "central Bohemia", "Prague"], "y": [8611.181818181818, 8728.5, 8831.5, 9015.4, 9049.181818181818, 9334.2, 9357.25, 12541.0], "type": "bar", "uid": "b3fe0da4-0e2b-40a8-9e34-0ace50b3b922"}], {"autosize": false, "height": 400, "title": {"text": "Average salary per region"}, "width": 600}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script>
</div>
</div>
</section>
<section id="business-questions-part-1-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-1-conclusion">Business questions part #1 conclusion:</h3>
<ul>
<li>Men and women almost equally presented among the bank’s customers, 50.74% for men and 49.26% for women.</li>
<li>Majority of clients are between age of 20 to 60.</li>
<li>Most of the customers are living in South and North Moravia, on the contrerary South and West Bohemia are the least presented regions. Average salary is nearly evenly distributed among regions except Prague (capital of the country) where average salary is noticeably higher. Apparently invasion into Prague banking market should be reinforced.<br>
</li>
<li><strong>Following districts are the most attractive: Hl. m. Praha, Brno-mesto, Karvina, Ostrava-mesto, Praha-Vychod, Frydek-Mistek (pretty close to the criteria) for future market presence grow. </strong></li>
</ul>
</section>
<section id="business-questions-part-2---card-products-patterns" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-2---card-products-patterns">Business questions part #2 - Card products’ patterns</h3>
<ul>
<li>Overall view on the proportion of issued card products.<br>
</li>
<li>Card products distribution among different regions of Czech. Is there any regions where specific card products are more popular than another?<br>
</li>
<li>Cards issuance trends from 1993 to 1998 overview.</li>
</ul>
<div class="cell" data-execution_count="734">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Card products popularity </span></span>
<span id="cb53-2"><a href="#cb53-2"></a></span>
<span id="cb53-3"><a href="#cb53-3"></a>product_count <span class="op">=</span> Counter (cards_df [<span class="st">'type'</span>])</span>
<span id="cb53-4"><a href="#cb53-4"></a>product_counts <span class="op">=</span> pd.DataFrame.from_dict (product_count, orient <span class="op">=</span> <span class="st">'index'</span>)</span>
<span id="cb53-5"><a href="#cb53-5"></a>product_counts.columns <span class="op">=</span> [<span class="st">'Percentage_ratio'</span>]</span>
<span id="cb53-6"><a href="#cb53-6"></a>product_counts <span class="op">=</span> product_counts <span class="op">/</span> (product_counts [<span class="st">'Percentage_ratio'</span>].<span class="bu">sum</span> ()) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>product_counts.plot (kind <span class="op">=</span> <span class="st">'bar'</span>,</span>
<span id="cb53-8"><a href="#cb53-8"></a>                    title <span class="op">=</span> <span class="st">'Card products distribution'</span>,</span>
<span id="cb53-9"><a href="#cb53-9"></a>                    width <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span id="cb53-10"><a href="#cb53-10"></a>                    figsize <span class="op">=</span> (<span class="dv">7</span>, <span class="fl">4.8</span>),</span>
<span id="cb53-11"><a href="#cb53-11"></a>                    subplots <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb53-12"><a href="#cb53-12"></a>                    color <span class="op">=</span> [plt.cm.Paired(np.arange(<span class="bu">len</span>(region_counts)))]</span>
<span id="cb53-13"><a href="#cb53-13"></a>                    )</span>
<span id="cb53-14"><a href="#cb53-14"></a>display (product_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Counter({'classic': 659, 'junior': 145, 'gold': 88})</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-27-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="735">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="co">#merging cards_df and corresponding dispos_df so to find client_id and then from client_id to find corresponding region data</span></span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a>cards_disp_df <span class="op">=</span> cards_df</span>
<span id="cb55-4"><a href="#cb55-4"></a>cards_disp2_df <span class="op">=</span> cards_disp_df.merge (dispos_df, left_on <span class="op">=</span> <span class="st">'disp_id'</span>, right_on <span class="op">=</span> <span class="st">'disp_id'</span>, </span>
<span id="cb55-5"><a href="#cb55-5"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb55-6"><a href="#cb55-6"></a>display (cards_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb55-7"><a href="#cb55-7"></a>display (cards_disp2_df.head (n<span class="op">=</span><span class="dv">3</span>))     </span>
<span id="cb55-8"><a href="#cb55-8"></a><span class="bu">print</span> (<span class="st">"Verifying shape. Before: "</span> <span class="op">+</span> <span class="bu">str</span> (cards_df.shape)<span class="op">+</span> <span class="st">" After: "</span> <span class="op">+</span> <span class="bu">str</span> (cards_disp2_df.shape))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
      <th>type</th>
      <th>issued</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1005</td>
      <td>9285</td>
      <td>classic</td>
      <td>931107 00:00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>104</td>
      <td>588</td>
      <td>classic</td>
      <td>940119 00:00:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>747</td>
      <td>4915</td>
      <td>classic</td>
      <td>940205 00:00:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
      <th>type_x</th>
      <th>issued</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1005</td>
      <td>9285</td>
      <td>classic</td>
      <td>931107 00:00:00</td>
      <td>9593</td>
      <td>7753</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>1</th>
      <td>104</td>
      <td>588</td>
      <td>classic</td>
      <td>940119 00:00:00</td>
      <td>588</td>
      <td>489</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>2</th>
      <td>747</td>
      <td>4915</td>
      <td>classic</td>
      <td>940205 00:00:00</td>
      <td>4915</td>
      <td>4078</td>
      <td>OWNER</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Verifying shape. Before: (892, 4) After: (892, 7)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="736">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="co">#merging cards_disp2_df with clients_dist2_df. as a result I will have a df with card products and corresponding regions info</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co">#in the same DF</span></span>
<span id="cb57-3"><a href="#cb57-3"></a></span>
<span id="cb57-4"><a href="#cb57-4"></a>cards_disp3_df <span class="op">=</span> cards_disp2_df</span>
<span id="cb57-5"><a href="#cb57-5"></a>cards_disp_reg_df <span class="op">=</span> cards_disp3_df.merge (clients_dist2_df, left_on <span class="op">=</span> <span class="st">'client_id'</span>, right_on <span class="op">=</span> <span class="st">'client_id'</span>, </span>
<span id="cb57-6"><a href="#cb57-6"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb57-7"><a href="#cb57-7"></a>display (cards_disp2_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb57-8"><a href="#cb57-8"></a>display (cards_disp_reg_df.head (n<span class="op">=</span><span class="dv">3</span>))     </span>
<span id="cb57-9"><a href="#cb57-9"></a><span class="bu">print</span> (<span class="st">"Verifying shape. Before: "</span> <span class="op">+</span> <span class="bu">str</span> (cards_disp2_df.shape)<span class="op">+</span> <span class="st">" After: "</span> <span class="op">+</span> <span class="bu">str</span> (cards_disp_reg_df.shape))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
      <th>type_x</th>
      <th>issued</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1005</td>
      <td>9285</td>
      <td>classic</td>
      <td>931107 00:00:00</td>
      <td>9593</td>
      <td>7753</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>1</th>
      <td>104</td>
      <td>588</td>
      <td>classic</td>
      <td>940119 00:00:00</td>
      <td>588</td>
      <td>489</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>2</th>
      <td>747</td>
      <td>4915</td>
      <td>classic</td>
      <td>940205 00:00:00</td>
      <td>4915</td>
      <td>4078</td>
      <td>OWNER</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
      <th>type_x</th>
      <th>issued</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type_y</th>
      <th>birth_number</th>
      <th>district_id</th>
      <th>birth_date</th>
      <th>...</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A12</th>
      <th>A13</th>
      <th>A14</th>
      <th>A15</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1005</td>
      <td>9285</td>
      <td>classic</td>
      <td>931107 00:00:00</td>
      <td>9593</td>
      <td>7753</td>
      <td>OWNER</td>
      <td>685128</td>
      <td>74</td>
      <td>1968-01-28</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>100.0</td>
      <td>10673</td>
      <td>4.75</td>
      <td>5.44</td>
      <td>100</td>
      <td>18782</td>
      <td>18347</td>
    </tr>
    <tr>
      <th>1</th>
      <td>104</td>
      <td>588</td>
      <td>classic</td>
      <td>940119 00:00:00</td>
      <td>588</td>
      <td>489</td>
      <td>OWNER</td>
      <td>606020</td>
      <td>61</td>
      <td>1960-10-20</td>
      <td>...</td>
      <td>5</td>
      <td>1</td>
      <td>6</td>
      <td>53.8</td>
      <td>8814</td>
      <td>4.76</td>
      <td>5.74</td>
      <td>107</td>
      <td>2112</td>
      <td>2059</td>
    </tr>
    <tr>
      <th>2</th>
      <td>747</td>
      <td>4915</td>
      <td>classic</td>
      <td>940205 00:00:00</td>
      <td>4915</td>
      <td>4078</td>
      <td>OWNER</td>
      <td>630719</td>
      <td>40</td>
      <td>1963-07-19</td>
      <td>...</td>
      <td>6</td>
      <td>3</td>
      <td>8</td>
      <td>85.3</td>
      <td>9317</td>
      <td>6.49</td>
      <td>7.07</td>
      <td>97</td>
      <td>6949</td>
      <td>6872</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 28 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Verifying shape. Before: (892, 7) After: (892, 28)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="737">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="co">#preparing dataset for plotting of number of products per regions</span></span>
<span id="cb59-2"><a href="#cb59-2"></a></span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="co">#grouping by region ("A3") and card product ('type_x'), then counting number of cards </span></span>
<span id="cb59-4"><a href="#cb59-4"></a>region_product_df <span class="op">=</span> pd.DataFrame (cards_disp_reg_df.groupby ([<span class="st">'A3'</span>, <span class="st">'type_x'</span>], axis <span class="op">=</span> <span class="dv">0</span>) [<span class="st">'type_x'</span>].count ())</span>
<span id="cb59-5"><a href="#cb59-5"></a>region_product_df.columns <span class="op">=</span> [<span class="st">'count'</span>]</span>
<span id="cb59-6"><a href="#cb59-6"></a></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="co">#making columns out of multi-index of A3 and type_x so to make it easier to operate with values</span></span>
<span id="cb59-8"><a href="#cb59-8"></a>region_product_df.reset_index (level<span class="op">=</span> [<span class="st">'type_x'</span>, <span class="st">'A3'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb59-9"><a href="#cb59-9"></a>display (region_product_df .head (n<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A3</th>
      <th>type_x</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Prague</td>
      <td>classic</td>
      <td>96</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Prague</td>
      <td>gold</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Prague</td>
      <td>junior</td>
      <td>22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>central Bohemia</td>
      <td>classic</td>
      <td>88</td>
    </tr>
    <tr>
      <th>4</th>
      <td>central Bohemia</td>
      <td>gold</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="738">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a>regions_duplicate <span class="op">=</span> region_product_df.copy () <span class="co">#should be used as copy () otherwise in the loop both df updated</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="cf">for</span> ids, item <span class="kw">in</span> <span class="bu">enumerate</span> (region_product_df [<span class="st">'A3'</span>]):</span>
<span id="cb60-3"><a href="#cb60-3"></a>    count_sum <span class="op">=</span> regions_duplicate.loc [ids, <span class="st">'count'</span>]</span>
<span id="cb60-4"><a href="#cb60-4"></a>    div_sum <span class="op">=</span> regions_duplicate [regions_duplicate [<span class="st">'A3'</span>] <span class="op">==</span> item] [<span class="st">'count'</span>]. <span class="bu">sum</span> ()</span>
<span id="cb60-5"><a href="#cb60-5"></a>    region_product_df.loc [ids, <span class="st">'count'</span>] <span class="op">=</span> <span class="bu">round</span> (count_sum <span class="op">/</span> (div_sum) <span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb60-6"><a href="#cb60-6"></a>display (region_product_df .head (n<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A3</th>
      <th>type_x</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Prague</td>
      <td>classic</td>
      <td>74.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Prague</td>
      <td>gold</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Prague</td>
      <td>junior</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>central Bohemia</td>
      <td>classic</td>
      <td>73.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>central Bohemia</td>
      <td>gold</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="739">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co">#plotting percentage of card products per regions </span></span>
<span id="cb61-2"><a href="#cb61-2"></a>x <span class="op">=</span> <span class="bu">list</span> (region_product_df [<span class="st">'A3'</span>].unique()) <span class="co">#region names</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>y <span class="op">=</span>  <span class="bu">list</span> (region_product_df [region_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'junior'</span>] [<span class="st">'count'</span>]) <span class="co">#junior</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>y2 <span class="op">=</span> <span class="bu">list</span> (region_product_df [region_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'classic'</span>] [<span class="st">'count'</span>]) <span class="co">#classic</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>y3 <span class="op">=</span> <span class="bu">list</span> (region_product_df [region_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'gold'</span>] [<span class="st">'count'</span>]) <span class="co">#gold</span></span>
<span id="cb61-6"><a href="#cb61-6"></a>junior <span class="op">=</span> go.Bar(</span>
<span id="cb61-7"><a href="#cb61-7"></a>    x<span class="op">=</span>x,</span>
<span id="cb61-8"><a href="#cb61-8"></a>    y<span class="op">=</span>y,</span>
<span id="cb61-9"><a href="#cb61-9"></a>    text<span class="op">=</span> y,</span>
<span id="cb61-10"><a href="#cb61-10"></a>    name <span class="op">=</span> <span class="st">'Junior'</span>,</span>
<span id="cb61-11"><a href="#cb61-11"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb61-12"><a href="#cb61-12"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb61-13"><a href="#cb61-13"></a>        color<span class="op">=</span><span class="st">'rgb(158,202,225)'</span>,</span>
<span id="cb61-14"><a href="#cb61-14"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb61-15"><a href="#cb61-15"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb61-16"><a href="#cb61-16"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb61-17"><a href="#cb61-17"></a>        ),</span>
<span id="cb61-18"><a href="#cb61-18"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb61-19"><a href="#cb61-19"></a>)</span>
<span id="cb61-20"><a href="#cb61-20"></a>classic <span class="op">=</span> go.Bar(</span>
<span id="cb61-21"><a href="#cb61-21"></a>    x<span class="op">=</span>x,</span>
<span id="cb61-22"><a href="#cb61-22"></a>    y<span class="op">=</span>y2,</span>
<span id="cb61-23"><a href="#cb61-23"></a>    text<span class="op">=</span>y2,</span>
<span id="cb61-24"><a href="#cb61-24"></a>    name <span class="op">=</span> <span class="st">'Classic'</span>,</span>
<span id="cb61-25"><a href="#cb61-25"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb61-26"><a href="#cb61-26"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb61-27"><a href="#cb61-27"></a>        color<span class="op">=</span><span class="st">'rgb(0,100,0)'</span>,</span>
<span id="cb61-28"><a href="#cb61-28"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb61-29"><a href="#cb61-29"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb61-30"><a href="#cb61-30"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb61-31"><a href="#cb61-31"></a>        ),</span>
<span id="cb61-32"><a href="#cb61-32"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb61-33"><a href="#cb61-33"></a>)</span>
<span id="cb61-34"><a href="#cb61-34"></a>gold <span class="op">=</span> go.Bar(</span>
<span id="cb61-35"><a href="#cb61-35"></a>    x<span class="op">=</span>x,</span>
<span id="cb61-36"><a href="#cb61-36"></a>    y<span class="op">=</span>y3,</span>
<span id="cb61-37"><a href="#cb61-37"></a>    text<span class="op">=</span>y3,</span>
<span id="cb61-38"><a href="#cb61-38"></a>    name <span class="op">=</span> <span class="st">'Gold'</span>,</span>
<span id="cb61-39"><a href="#cb61-39"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb61-40"><a href="#cb61-40"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb61-41"><a href="#cb61-41"></a>        color<span class="op">=</span><span class="st">'rgb(255,215,0)'</span>,</span>
<span id="cb61-42"><a href="#cb61-42"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb61-43"><a href="#cb61-43"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb61-44"><a href="#cb61-44"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb61-45"><a href="#cb61-45"></a>        ),</span>
<span id="cb61-46"><a href="#cb61-46"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb61-47"><a href="#cb61-47"></a>)</span>
<span id="cb61-48"><a href="#cb61-48"></a>data <span class="op">=</span> [junior, classic, gold]</span>
<span id="cb61-49"><a href="#cb61-49"></a>py.iplot(data, filename<span class="op">=</span><span class="st">'grouped-bar-direct-labels'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="f241d643-1a9f-407c-a5db-7c3973ce797c" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("f241d643-1a9f-407c-a5db-7c3973ce797c", [{"marker": {"color": "rgb(158,202,225)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Junior", "opacity": 0.6, "text": ["17.0", "19.0", "19.0", "14.0", "15.0", "18.0", "15.0", "14.0"], "textposition": "auto", "x": ["Prague", "central Bohemia", "east Bohemia", "north Bohemia", "north Moravia", "south Bohemia", "south Moravia", "west Bohemia"], "y": [17.0, 19.0, 19.0, 14.0, 15.0, 18.0, 15.0, 14.0], "type": "bar", "uid": "eee0f108-38c6-4fa0-a307-b4113cb7fedc"}, {"marker": {"color": "rgb(0,100,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Classic", "opacity": 0.6, "text": ["74.0", "73.0", "72.0", "72.0", "72.0", "77.0", "76.0", "76.0"], "textposition": "auto", "x": ["Prague", "central Bohemia", "east Bohemia", "north Bohemia", "north Moravia", "south Bohemia", "south Moravia", "west Bohemia"], "y": [74.0, 73.0, 72.0, 72.0, 72.0, 77.0, 76.0, 76.0], "type": "bar", "uid": "e3baf393-7a6e-4ddd-8eee-0bf0a23969f8"}, {"marker": {"color": "rgb(255,215,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Gold", "opacity": 0.6, "text": ["9.0", "8.0", "9.0", "15.0", "14.0", "5.0", "8.0", "9.0"], "textposition": "auto", "x": ["Prague", "central Bohemia", "east Bohemia", "north Bohemia", "north Moravia", "south Bohemia", "south Moravia", "west Bohemia"], "y": [9.0, 8.0, 9.0, 15.0, 14.0, 5.0, 8.0, 9.0], "type": "bar", "uid": "42375fd4-c5fc-43ae-94db-8e1895d9bd13"}], {}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script><script type="text/javascript">window.addEventListener("resize", function(){window._Plotly.Plots.resize(document.getElementById("f241d643-1a9f-407c-a5db-7c3973ce797c"));});</script>
</div>
</div>
<div class="cell" data-execution_count="740">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a><span class="co">#preparing dataset for plotting trends of cards issuance per years</span></span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="co">#adding a column that will reflect specific year when a card was issued</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>cards_disp2_df [<span class="st">'issue_year'</span>] <span class="op">=</span> cards_disp2_df [<span class="st">'issued'</span>]</span>
<span id="cb62-5"><a href="#cb62-5"></a></span>
<span id="cb62-6"><a href="#cb62-6"></a>cards_disp2_df [<span class="st">'issue_year'</span>] <span class="op">=</span> cards_disp2_df [<span class="st">'issue_year'</span>].<span class="bu">apply</span> (date_parsing)</span>
<span id="cb62-7"><a href="#cb62-7"></a>cards_disp2_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="740">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>card_id</th>
      <th>disp_id</th>
      <th>type_x</th>
      <th>issued</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type_y</th>
      <th>issue_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1005</td>
      <td>9285</td>
      <td>classic</td>
      <td>931107 00:00:00</td>
      <td>9593</td>
      <td>7753</td>
      <td>OWNER</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>1</th>
      <td>104</td>
      <td>588</td>
      <td>classic</td>
      <td>940119 00:00:00</td>
      <td>588</td>
      <td>489</td>
      <td>OWNER</td>
      <td>1994</td>
    </tr>
    <tr>
      <th>2</th>
      <td>747</td>
      <td>4915</td>
      <td>classic</td>
      <td>940205 00:00:00</td>
      <td>4915</td>
      <td>4078</td>
      <td>OWNER</td>
      <td>1994</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="741">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">#grouping by issue_year and card product ('type_x'), then counting number of cards </span></span>
<span id="cb63-2"><a href="#cb63-2"></a>year_product_df <span class="op">=</span> pd.DataFrame (cards_disp2_df.groupby ([<span class="st">'issue_year'</span>, <span class="st">'type_x'</span>], axis <span class="op">=</span> <span class="dv">0</span>) [<span class="st">'type_x'</span>].count ())</span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="co">#naming column as 'count' </span></span>
<span id="cb63-5"><a href="#cb63-5"></a>year_product_df.columns <span class="op">=</span> [<span class="st">'count'</span>]</span>
<span id="cb63-6"><a href="#cb63-6"></a></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="co">#making columns out of multi-index of A3 and type_x so to make it easier to operate with values</span></span>
<span id="cb63-8"><a href="#cb63-8"></a>year_product_df.reset_index (level<span class="op">=</span> [<span class="st">'type_x'</span>, <span class="st">'issue_year'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb63-9"><a href="#cb63-9"></a>display (year_product_df .head (n<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>issue_year</th>
      <th>type_x</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1993</td>
      <td>classic</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1994</td>
      <td>classic</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1994</td>
      <td>junior</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1995</td>
      <td>classic</td>
      <td>42</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1995</td>
      <td>gold</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="742">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a><span class="co">#no values for junior and gold products in 1993 and no values for gold cards in 1994</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="co">#adding them as zeroes</span></span>
<span id="cb64-3"><a href="#cb64-3"></a></span>
<span id="cb64-4"><a href="#cb64-4"></a>list_of_zer <span class="op">=</span> [pd.Series ([<span class="dv">1993</span>, <span class="st">'junior'</span>, <span class="dv">0</span>], index <span class="op">=</span> year_product_df.columns),</span>
<span id="cb64-5"><a href="#cb64-5"></a>               pd.Series ([<span class="dv">1993</span>, <span class="st">'gold'</span>, <span class="dv">0</span>], index <span class="op">=</span> year_product_df.columns),</span>
<span id="cb64-6"><a href="#cb64-6"></a>               pd.Series ([<span class="dv">1994</span>, <span class="st">'gold'</span>, <span class="dv">0</span>], index <span class="op">=</span> year_product_df.columns),</span>
<span id="cb64-7"><a href="#cb64-7"></a>                ]</span>
<span id="cb64-8"><a href="#cb64-8"></a>year_product_df <span class="op">=</span> year_product_df.append (list_of_zer, ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb64-9"><a href="#cb64-9"></a>year_product_df.sort_values ([<span class="st">'issue_year'</span>, <span class="st">'type_x'</span>], inplace<span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb64-10"><a href="#cb64-10"></a>year_product_df.reset_index (inplace <span class="op">=</span> <span class="va">True</span>, drop <span class="op">=</span> <span class="va">True</span>) <span class="co">#making index start from 0 again</span></span>
<span id="cb64-11"><a href="#cb64-11"></a>display (year_product_df .head (n<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>issue_year</th>
      <th>type_x</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1993</td>
      <td>classic</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1993</td>
      <td>gold</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1993</td>
      <td>junior</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1994</td>
      <td>classic</td>
      <td>17</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1994</td>
      <td>gold</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="743">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a><span class="co">#plotting number of card products per years </span></span>
<span id="cb65-2"><a href="#cb65-2"></a>x <span class="op">=</span> <span class="bu">list</span> (year_product_df [<span class="st">'issue_year'</span>].unique()) <span class="co">#years </span></span>
<span id="cb65-3"><a href="#cb65-3"></a>y <span class="op">=</span>  <span class="bu">list</span> (year_product_df [year_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'junior'</span>] [<span class="st">'count'</span>]) <span class="co">#junior</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>y2 <span class="op">=</span> <span class="bu">list</span> (year_product_df [year_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'classic'</span>] [<span class="st">'count'</span>]) <span class="co">#classic</span></span>
<span id="cb65-5"><a href="#cb65-5"></a>y3 <span class="op">=</span> <span class="bu">list</span> (year_product_df [year_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'gold'</span>] [<span class="st">'count'</span>]) <span class="co">#gold</span></span>
<span id="cb65-6"><a href="#cb65-6"></a></span>
<span id="cb65-7"><a href="#cb65-7"></a>junior <span class="op">=</span> go.Bar(</span>
<span id="cb65-8"><a href="#cb65-8"></a>    x<span class="op">=</span>x,</span>
<span id="cb65-9"><a href="#cb65-9"></a>    y<span class="op">=</span>y,</span>
<span id="cb65-10"><a href="#cb65-10"></a>    text<span class="op">=</span> y,</span>
<span id="cb65-11"><a href="#cb65-11"></a>    name <span class="op">=</span> <span class="st">'Junior'</span>,</span>
<span id="cb65-12"><a href="#cb65-12"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb65-13"><a href="#cb65-13"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb65-14"><a href="#cb65-14"></a>        color<span class="op">=</span><span class="st">'rgb(158,202,225)'</span>,</span>
<span id="cb65-15"><a href="#cb65-15"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb65-16"><a href="#cb65-16"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb65-17"><a href="#cb65-17"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb65-18"><a href="#cb65-18"></a>        ),</span>
<span id="cb65-19"><a href="#cb65-19"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb65-20"><a href="#cb65-20"></a>)</span>
<span id="cb65-21"><a href="#cb65-21"></a>classic <span class="op">=</span> go.Bar(</span>
<span id="cb65-22"><a href="#cb65-22"></a>    x<span class="op">=</span>x,</span>
<span id="cb65-23"><a href="#cb65-23"></a>    y<span class="op">=</span>y2,</span>
<span id="cb65-24"><a href="#cb65-24"></a>    text<span class="op">=</span>y2,</span>
<span id="cb65-25"><a href="#cb65-25"></a>    name <span class="op">=</span> <span class="st">'Classic'</span>,</span>
<span id="cb65-26"><a href="#cb65-26"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb65-27"><a href="#cb65-27"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb65-28"><a href="#cb65-28"></a>        color<span class="op">=</span><span class="st">'rgb(0,100,0)'</span>,</span>
<span id="cb65-29"><a href="#cb65-29"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb65-30"><a href="#cb65-30"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb65-31"><a href="#cb65-31"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb65-32"><a href="#cb65-32"></a>        ),</span>
<span id="cb65-33"><a href="#cb65-33"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb65-34"><a href="#cb65-34"></a>)</span>
<span id="cb65-35"><a href="#cb65-35"></a>gold <span class="op">=</span> go.Bar(</span>
<span id="cb65-36"><a href="#cb65-36"></a>    x<span class="op">=</span>x,</span>
<span id="cb65-37"><a href="#cb65-37"></a>    y<span class="op">=</span>y3,</span>
<span id="cb65-38"><a href="#cb65-38"></a>    text<span class="op">=</span>y3,</span>
<span id="cb65-39"><a href="#cb65-39"></a>    name <span class="op">=</span> <span class="st">'Gold'</span>,</span>
<span id="cb65-40"><a href="#cb65-40"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb65-41"><a href="#cb65-41"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb65-42"><a href="#cb65-42"></a>        color<span class="op">=</span><span class="st">'rgb(255,215,0)'</span>,</span>
<span id="cb65-43"><a href="#cb65-43"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb65-44"><a href="#cb65-44"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb65-45"><a href="#cb65-45"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb65-46"><a href="#cb65-46"></a>        ),</span>
<span id="cb65-47"><a href="#cb65-47"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb65-48"><a href="#cb65-48"></a>)</span>
<span id="cb65-49"><a href="#cb65-49"></a>data <span class="op">=</span> [junior, classic, gold]</span>
<span id="cb65-50"><a href="#cb65-50"></a>py.iplot(data, filename<span class="op">=</span><span class="st">'grouped-bar-direct-labels'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="2ec9dba7-46a9-4234-be68-9a78384e28c8" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("2ec9dba7-46a9-4234-be68-9a78384e28c8", [{"marker": {"color": "rgb(158,202,225)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Junior", "opacity": 0.6, "text": ["0", "4", "17", "28", "26", "70"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [0, 4, 17, 28, 26, 70], "type": "bar", "uid": "04b04581-e6a2-404c-a90e-450fae1d98e6"}, {"marker": {"color": "rgb(0,100,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Classic", "opacity": 0.6, "text": ["1", "17", "42", "83", "190", "326"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [1, 17, 42, 83, 190, 326], "type": "bar", "uid": "13f33064-dd18-4d1d-a77f-872e70d6e5f5"}, {"marker": {"color": "rgb(255,215,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Gold", "opacity": 0.6, "text": ["0", "0", "4", "5", "26", "53"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [0, 0, 4, 5, 26, 53], "type": "bar", "uid": "e22e551d-8e53-48f9-a578-1d4ad98ce9c5"}], {}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script><script type="text/javascript">window.addEventListener("resize", function(){window._Plotly.Plots.resize(document.getElementById("2ec9dba7-46a9-4234-be68-9a78384e28c8"));});</script>
</div>
</div>
<div class="cell" data-execution_count="744">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a><span class="co">#making a new dataset that will contain percentage of each card product per year </span></span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a>year_duplicate <span class="op">=</span> year_product_df.copy () <span class="co">#should be used as copy () otherwise in the loop both df updated</span></span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="cf">for</span> ids, item <span class="kw">in</span> <span class="bu">enumerate</span> (year_product_df [<span class="st">'issue_year'</span>]):</span>
<span id="cb66-5"><a href="#cb66-5"></a>    count_sum <span class="op">=</span> year_duplicate.loc [ids, <span class="st">'count'</span>]</span>
<span id="cb66-6"><a href="#cb66-6"></a>    div_sum <span class="op">=</span> year_duplicate [year_duplicate [<span class="st">'issue_year'</span>] <span class="op">==</span> item] [<span class="st">'count'</span>]. <span class="bu">sum</span> ()</span>
<span id="cb66-7"><a href="#cb66-7"></a>    year_product_df.loc [ids, <span class="st">'count'</span>] <span class="op">=</span> <span class="bu">round</span> (count_sum <span class="op">/</span> (div_sum) <span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb66-8"><a href="#cb66-8"></a>      </span>
<span id="cb66-9"><a href="#cb66-9"></a>display (year_product_df .head (n<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>issue_year</th>
      <th>type_x</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1993</td>
      <td>classic</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1993</td>
      <td>gold</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1993</td>
      <td>junior</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1994</td>
      <td>classic</td>
      <td>81.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1994</td>
      <td>gold</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="745">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a><span class="co">#plotting percentafe of card products per years </span></span>
<span id="cb67-2"><a href="#cb67-2"></a>x <span class="op">=</span> <span class="bu">list</span> (year_product_df [<span class="st">'issue_year'</span>].unique()) <span class="co">#years </span></span>
<span id="cb67-3"><a href="#cb67-3"></a>y <span class="op">=</span>  <span class="bu">list</span> (year_product_df [year_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'junior'</span>] [<span class="st">'count'</span>]) <span class="co">#junior</span></span>
<span id="cb67-4"><a href="#cb67-4"></a>y2 <span class="op">=</span> <span class="bu">list</span> (year_product_df [year_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'classic'</span>] [<span class="st">'count'</span>]) <span class="co">#classic</span></span>
<span id="cb67-5"><a href="#cb67-5"></a>y3 <span class="op">=</span> <span class="bu">list</span> (year_product_df [year_product_df [<span class="st">'type_x'</span>] <span class="op">==</span> <span class="st">'gold'</span>] [<span class="st">'count'</span>]) <span class="co">#gold</span></span>
<span id="cb67-6"><a href="#cb67-6"></a></span>
<span id="cb67-7"><a href="#cb67-7"></a>junior <span class="op">=</span> go.Bar(</span>
<span id="cb67-8"><a href="#cb67-8"></a>    x<span class="op">=</span>x,</span>
<span id="cb67-9"><a href="#cb67-9"></a>    y<span class="op">=</span>y,</span>
<span id="cb67-10"><a href="#cb67-10"></a>    text<span class="op">=</span> y,</span>
<span id="cb67-11"><a href="#cb67-11"></a>    name <span class="op">=</span> <span class="st">'Junior'</span>,</span>
<span id="cb67-12"><a href="#cb67-12"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb67-13"><a href="#cb67-13"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb67-14"><a href="#cb67-14"></a>        color<span class="op">=</span><span class="st">'rgb(158,202,225)'</span>,</span>
<span id="cb67-15"><a href="#cb67-15"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb67-16"><a href="#cb67-16"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb67-17"><a href="#cb67-17"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb67-18"><a href="#cb67-18"></a>        ),</span>
<span id="cb67-19"><a href="#cb67-19"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb67-20"><a href="#cb67-20"></a>)</span>
<span id="cb67-21"><a href="#cb67-21"></a>classic <span class="op">=</span> go.Bar(</span>
<span id="cb67-22"><a href="#cb67-22"></a>    x<span class="op">=</span>x,</span>
<span id="cb67-23"><a href="#cb67-23"></a>    y<span class="op">=</span>y2,</span>
<span id="cb67-24"><a href="#cb67-24"></a>    text<span class="op">=</span>y2,</span>
<span id="cb67-25"><a href="#cb67-25"></a>    name <span class="op">=</span> <span class="st">'Classic'</span>,</span>
<span id="cb67-26"><a href="#cb67-26"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb67-27"><a href="#cb67-27"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb67-28"><a href="#cb67-28"></a>        color<span class="op">=</span><span class="st">'rgb(0,100,0)'</span>,</span>
<span id="cb67-29"><a href="#cb67-29"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb67-30"><a href="#cb67-30"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb67-31"><a href="#cb67-31"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb67-32"><a href="#cb67-32"></a>        ),</span>
<span id="cb67-33"><a href="#cb67-33"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb67-34"><a href="#cb67-34"></a>)</span>
<span id="cb67-35"><a href="#cb67-35"></a>gold <span class="op">=</span> go.Bar(</span>
<span id="cb67-36"><a href="#cb67-36"></a>    x<span class="op">=</span>x,</span>
<span id="cb67-37"><a href="#cb67-37"></a>    y<span class="op">=</span>y3,</span>
<span id="cb67-38"><a href="#cb67-38"></a>    text<span class="op">=</span>y3,</span>
<span id="cb67-39"><a href="#cb67-39"></a>    name <span class="op">=</span> <span class="st">'Gold'</span>,</span>
<span id="cb67-40"><a href="#cb67-40"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb67-41"><a href="#cb67-41"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb67-42"><a href="#cb67-42"></a>        color<span class="op">=</span><span class="st">'rgb(255,215,0)'</span>,</span>
<span id="cb67-43"><a href="#cb67-43"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb67-44"><a href="#cb67-44"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb67-45"><a href="#cb67-45"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb67-46"><a href="#cb67-46"></a>        ),</span>
<span id="cb67-47"><a href="#cb67-47"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb67-48"><a href="#cb67-48"></a>)</span>
<span id="cb67-49"><a href="#cb67-49"></a>data <span class="op">=</span> [junior, classic, gold]</span>
<span id="cb67-50"><a href="#cb67-50"></a>py.iplot(data, filename<span class="op">=</span><span class="st">'grouped-bar-direct-labels'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="a4f3dff5-079b-4de9-9486-5f33574a8141" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("a4f3dff5-079b-4de9-9486-5f33574a8141", [{"marker": {"color": "rgb(158,202,225)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Junior", "opacity": 0.6, "text": ["0.0", "19.0", "27.0", "24.0", "11.0", "16.0"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [0.0, 19.0, 27.0, 24.0, 11.0, 16.0], "type": "bar", "uid": "1d1dd054-ca62-4bcd-9b69-f08e58c31ad0"}, {"marker": {"color": "rgb(0,100,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Classic", "opacity": 0.6, "text": ["100.0", "81.0", "67.0", "72.0", "79.0", "73.0"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [100.0, 81.0, 67.0, 72.0, 79.0, 73.0], "type": "bar", "uid": "9e1fc609-1405-474a-b012-b5b0fb41df16"}, {"marker": {"color": "rgb(255,215,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Gold", "opacity": 0.6, "text": ["0.0", "0.0", "6.0", "4.0", "11.0", "12.0"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [0.0, 0.0, 6.0, 4.0, 11.0, 12.0], "type": "bar", "uid": "1a0e1c92-f558-46bd-8cfe-589d7d3453dd"}], {}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script><script type="text/javascript">window.addEventListener("resize", function(){window._Plotly.Plots.resize(document.getElementById("a4f3dff5-079b-4de9-9486-5f33574a8141"));});</script>
</div>
</div>
</section>
<section id="business-questions-part-2-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-2-conclusion">Business questions part #2 conclusion:</h3>
<ul>
<li>Overall view on the proportion of issued card products: 74% of issued cards are classic cards, 16% - junior cards and 10% - gold.<br>
</li>
<li>Card products distribution among different regions of Czech. Is there any regions where specific card products are more popular than another? Majority of cards in all regions are “classic” - more than 70%, junior cards prevail on gold in all regions except for North Bohemia.<br>
</li>
<li>Cards issuance trends from 1993 to 1998 overview. Number of issued cards growing from year to year. Classic cards remain the most popular among customers. Second place occupied by junior cards, gold cards on the third place, except for 1997 where number of both produced products is equal.</li>
</ul>
</section>
<section id="business-questions-part-3-loans-insight" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-3-loans-insight">Business questions part #3: loans insight</h3>
<ul>
<li>Does a loan with higher monthly payment generally tend to be unpaid or overdue?</li>
<li>Does longer duration of a loan pretend to protect against overdues in most of the cases?<br>
</li>
<li>Is there direct dependence between higher amount of a loan and higher probability the loan to be delinquent?</li>
<li>Loans status distribution within districts. Are there branches where credit exposure of the bank is not duly managed?</li>
</ul>
<div class="cell" data-execution_count="746">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a><span class="co">#preparing dataset and replacing A, B, C, D with description text</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>loans2_df <span class="op">=</span> loans_df.copy ()</span>
<span id="cb68-3"><a href="#cb68-3"></a>loans2_df [<span class="st">'status_desc'</span>] <span class="op">=</span> loans2_df [<span class="st">'status'</span>]</span>
<span id="cb68-4"><a href="#cb68-4"></a></span>
<span id="cb68-5"><a href="#cb68-5"></a>dict1 <span class="op">=</span>  {<span class="st">'A'</span>:<span class="st">'Contract finished, no problem'</span>, </span>
<span id="cb68-6"><a href="#cb68-6"></a>      <span class="st">'B'</span>:<span class="st">'Contract finised, loan was not paid'</span>,</span>
<span id="cb68-7"><a href="#cb68-7"></a>      <span class="st">'C'</span>:<span class="st">'Runing contract, OK so far'</span>,</span>
<span id="cb68-8"><a href="#cb68-8"></a>      <span class="st">'D'</span>:<span class="st">'Runing contract, client in debt'</span></span>
<span id="cb68-9"><a href="#cb68-9"></a>     }</span>
<span id="cb68-10"><a href="#cb68-10"></a>loans2_df.status_desc <span class="op">=</span> loans2_df.status_desc.replace (dict1)</span>
<span id="cb68-11"><a href="#cb68-11"></a></span>
<span id="cb68-12"><a href="#cb68-12"></a>loans2_df [<span class="st">'status_numeric'</span>] <span class="op">=</span> loans2_df [<span class="st">'status'</span>]</span>
<span id="cb68-13"><a href="#cb68-13"></a></span>
<span id="cb68-14"><a href="#cb68-14"></a><span class="co">#encoding bad loans as 1 and good ones as -1 </span></span>
<span id="cb68-15"><a href="#cb68-15"></a>dict2 <span class="op">=</span>  {<span class="st">'A'</span>:<span class="op">-</span><span class="dv">1</span>, </span>
<span id="cb68-16"><a href="#cb68-16"></a>      <span class="st">'B'</span>:<span class="dv">1</span>,</span>
<span id="cb68-17"><a href="#cb68-17"></a>      <span class="st">'C'</span>:<span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb68-18"><a href="#cb68-18"></a>      <span class="st">'D'</span>:<span class="dv">1</span></span>
<span id="cb68-19"><a href="#cb68-19"></a>     }</span>
<span id="cb68-20"><a href="#cb68-20"></a>loans2_df.status_numeric <span class="op">=</span> loans2_df.status_numeric.replace (dict2)</span>
<span id="cb68-21"><a href="#cb68-21"></a>display (loans2_df.head (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
      <th>status_desc</th>
      <th>status_numeric</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>1993-07-05</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
      <td>Contract finised, loan was not paid</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>1993-07-11</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>1993-07-28</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="747">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a><span class="co">#correlation between loan status and monthly payments</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="co">#display (loans2_df.groupby (['status_desc']).mean () ['payments'].sort_values ())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="748">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="co">#correlation between loan status and duration of a loan </span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="co">#loans2_df.groupby (['status_desc']).mean () ['duration'].sort_values ()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="749">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a><span class="co">#correlation between loan status and loan's amount </span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="co">#loans2_df.groupby (['status_desc']).mean () ['amount'].sort_values ()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="750">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="co">#correlation matrix</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>loans3_df <span class="op">=</span> loans2_df.copy ()</span>
<span id="cb72-3"><a href="#cb72-3"></a>loans3_df.drop ([<span class="st">'loan_id'</span>, <span class="st">'account_id'</span>], axis <span class="op">=</span><span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb72-4"><a href="#cb72-4"></a>sns.heatmap (loans3_df.corr (), annot <span class="op">=</span> <span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="751">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># enriching dataframe with accounts_df </span></span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a>loans_acc_df <span class="op">=</span> loans2_df.copy ()</span>
<span id="cb73-4"><a href="#cb73-4"></a>loans_acc_df <span class="op">=</span> loans_acc_df.merge (accounts_df, left_on <span class="op">=</span> <span class="st">'account_id'</span>, right_on <span class="op">=</span> <span class="st">'account_id'</span>, </span>
<span id="cb73-5"><a href="#cb73-5"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb73-6"><a href="#cb73-6"></a>display (loans2_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb73-7"><a href="#cb73-7"></a>display (loans_acc_df.head (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
      <th>status_desc</th>
      <th>status_numeric</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>1993-07-05</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
      <td>Contract finised, loan was not paid</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>1993-07-11</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>1993-07-28</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date_x</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
      <th>status_desc</th>
      <th>status_numeric</th>
      <th>district_id</th>
      <th>frequency</th>
      <th>date_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>1993-07-05</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
      <td>Contract finised, loan was not paid</td>
      <td>1</td>
      <td>30</td>
      <td>POPLATEK TYDNE</td>
      <td>1993-03-22</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>1993-07-11</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>46</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-02-13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>1993-07-28</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>45</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-02-08</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="752">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># enriching dataframe with district_df data</span></span>
<span id="cb74-2"><a href="#cb74-2"></a></span>
<span id="cb74-3"><a href="#cb74-3"></a>loans_acc_distr_df <span class="op">=</span> loans_acc_df.copy ()</span>
<span id="cb74-4"><a href="#cb74-4"></a>loans_acc_distr_df <span class="op">=</span> loans_acc_distr_df.merge (district_df, left_on <span class="op">=</span> <span class="st">'district_id'</span>, right_on <span class="op">=</span> <span class="st">'A1'</span>, </span>
<span id="cb74-5"><a href="#cb74-5"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb74-6"><a href="#cb74-6"></a>display (loans_acc_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb74-7"><a href="#cb74-7"></a>display (loans_acc_distr_df.head (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date_x</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
      <th>status_desc</th>
      <th>status_numeric</th>
      <th>district_id</th>
      <th>frequency</th>
      <th>date_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>1993-07-05</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
      <td>Contract finised, loan was not paid</td>
      <td>1</td>
      <td>30</td>
      <td>POPLATEK TYDNE</td>
      <td>1993-03-22</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>1993-07-11</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>46</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-02-13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>1993-07-28</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>45</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-02-08</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date_x</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
      <th>status_desc</th>
      <th>status_numeric</th>
      <th>district_id</th>
      <th>...</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A12</th>
      <th>A13</th>
      <th>A14</th>
      <th>A15</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>1993-07-05</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
      <td>Contract finised, loan was not paid</td>
      <td>1</td>
      <td>30</td>
      <td>...</td>
      <td>8</td>
      <td>2</td>
      <td>10</td>
      <td>81.8</td>
      <td>9650</td>
      <td>3.38</td>
      <td>3.67</td>
      <td>100</td>
      <td>2985</td>
      <td>2804</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>1993-07-11</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>46</td>
      <td>...</td>
      <td>7</td>
      <td>3</td>
      <td>10</td>
      <td>73.5</td>
      <td>8369</td>
      <td>1.79</td>
      <td>2.31</td>
      <td>117</td>
      <td>2854</td>
      <td>2618</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>1993-07-28</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>45</td>
      <td>...</td>
      <td>6</td>
      <td>1</td>
      <td>5</td>
      <td>53.5</td>
      <td>8390</td>
      <td>2.28</td>
      <td>2.89</td>
      <td>132</td>
      <td>2080</td>
      <td>2122</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 28 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="753">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="co">#number of duplicated accounts in loans_acc_df. I was checking if several loans can be tied to the same account ? </span></span>
<span id="cb75-2"><a href="#cb75-2"></a>test_df <span class="op">=</span> pd.DataFrame (loans_acc_df [<span class="st">'account_id'</span>].duplicated ())</span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="bu">print</span> (test_df [test_df [<span class="st">'account_id'</span>] <span class="op">==</span> <span class="va">True</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: [account_id]
Index: []</code></pre>
</div>
</div>
<p>The answer is “no” multiple loans cannot be tied to the same account</p>
<div class="cell" data-execution_count="754">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># enriching disposition dataframe with clients_df then I will have a df which will contain loan, district, </span></span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="co">#disposition and client info</span></span>
<span id="cb77-3"><a href="#cb77-3"></a></span>
<span id="cb77-4"><a href="#cb77-4"></a>dispos_client_df <span class="op">=</span> dispos_df.copy ()</span>
<span id="cb77-5"><a href="#cb77-5"></a>dispos_client_df <span class="op">=</span> dispos_client_df.merge (clients_df, left_on <span class="op">=</span> <span class="st">'client_id'</span>, right_on <span class="op">=</span> <span class="st">'client_id'</span>, </span>
<span id="cb77-6"><a href="#cb77-6"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb77-7"><a href="#cb77-7"></a>display (dispos_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb77-8"><a href="#cb77-8"></a>display (dispos_client_df.head (n<span class="op">=</span><span class="dv">3</span>))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>disp_id</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>OWNER</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>DISPONENT</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>disp_id</th>
      <th>client_id</th>
      <th>account_id</th>
      <th>type</th>
      <th>birth_number</th>
      <th>district_id</th>
      <th>birth_date</th>
      <th>gender</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>OWNER</td>
      <td>706213</td>
      <td>18</td>
      <td>1970-12-13</td>
      <td>0.0</td>
      <td>28</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>OWNER</td>
      <td>450204</td>
      <td>1</td>
      <td>1945-02-04</td>
      <td>1.0</td>
      <td>53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>DISPONENT</td>
      <td>406009</td>
      <td>1</td>
      <td>1940-10-09</td>
      <td>0.0</td>
      <td>58</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="755">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a><span class="co">#number of duplicated accounts in dispos_client_df. checking if the same account can be tied to several clients</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>test2_df <span class="op">=</span> pd.DataFrame (dispos_client_df [<span class="st">'account_id'</span>].duplicated ())</span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="bu">print</span> (dispos_client_df.shape) <span class="co">#number of disposition - clients </span></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="bu">print</span> (test2_df [test2_df [<span class="st">'account_id'</span>] <span class="op">==</span> <span class="va">True</span>].shape) <span class="co">#number of duplicates</span></span>
<span id="cb78-6"><a href="#cb78-6"></a></span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="bu">print</span> (<span class="st">'this means that same accounts can be owned by different clients where one of them can be owner and the second one disponent'</span>) </span>
<span id="cb78-8"><a href="#cb78-8"></a><span class="bu">print</span> (<span class="st">'Cannot merge enrich loans_acc_distr_df with some customer related data and see if some personal factors affects loan status as same account can be owned by different persons'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5369, 9)
(869, 1)
this means that same accounts can be owned by different clients where one of them can be owner and the second one disponent
Cannot merge enrich loans_acc_distr_df with some customer related data and see if some personal factors affects loan status as same account can be owned by different persons</code></pre>
</div>
</div>
<div class="cell" data-execution_count="756">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a><span class="co">#heatmap for correlation between districts and loan statuses</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>loans_acc_distr_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="756">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_id</th>
      <th>account_id</th>
      <th>date_x</th>
      <th>amount</th>
      <th>duration</th>
      <th>payments</th>
      <th>status</th>
      <th>status_desc</th>
      <th>status_numeric</th>
      <th>district_id</th>
      <th>...</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A12</th>
      <th>A13</th>
      <th>A14</th>
      <th>A15</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5314</td>
      <td>1787</td>
      <td>1993-07-05</td>
      <td>96396</td>
      <td>12</td>
      <td>8033.0</td>
      <td>B</td>
      <td>Contract finised, loan was not paid</td>
      <td>1</td>
      <td>30</td>
      <td>...</td>
      <td>8</td>
      <td>2</td>
      <td>10</td>
      <td>81.8</td>
      <td>9650</td>
      <td>3.38</td>
      <td>3.67</td>
      <td>100</td>
      <td>2985</td>
      <td>2804</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5316</td>
      <td>1801</td>
      <td>1993-07-11</td>
      <td>165960</td>
      <td>36</td>
      <td>4610.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>46</td>
      <td>...</td>
      <td>7</td>
      <td>3</td>
      <td>10</td>
      <td>73.5</td>
      <td>8369</td>
      <td>1.79</td>
      <td>2.31</td>
      <td>117</td>
      <td>2854</td>
      <td>2618</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6863</td>
      <td>9188</td>
      <td>1993-07-28</td>
      <td>127080</td>
      <td>60</td>
      <td>2118.0</td>
      <td>A</td>
      <td>Contract finished, no problem</td>
      <td>-1</td>
      <td>45</td>
      <td>...</td>
      <td>6</td>
      <td>1</td>
      <td>5</td>
      <td>53.5</td>
      <td>8390</td>
      <td>2.28</td>
      <td>2.89</td>
      <td>132</td>
      <td>2080</td>
      <td>2122</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 28 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="757">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="co">## Using the pandas.groupby() method to produce a pivot table:</span></span>
<span id="cb81-2"><a href="#cb81-2"></a></span>
<span id="cb81-3"><a href="#cb81-3"></a>dist_loans_df <span class="op">=</span> loans_acc_distr_df.groupby(by<span class="op">=</span>[<span class="st">'A2'</span>]).status_desc.value_counts().sort_index()</span>
<span id="cb81-4"><a href="#cb81-4"></a>dist_loans_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="757">
<pre><code>A2       status_desc                  
Benesov  Contract finished, no problem    1
         Runing contract, OK so far       5
Beroun   Contract finished, no problem    1
Name: status_desc, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="758">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="co">## Manipulating the data:</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>dist_loans_df <span class="op">=</span> dist_loans_df.unstack()  <span class="co">#Converting the groupby object into a dataset</span></span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="co">#dist_loans_df.head (n=10)</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>dist_loans_df.fillna(value<span class="op">=</span><span class="fl">0.0</span>, inplace<span class="op">=</span><span class="va">True</span>)  <span class="co">#Replacing NaN values by zero</span></span>
<span id="cb83-5"><a href="#cb83-5"></a>dist_loans_df <span class="op">=</span> df_row_normalize(dist_loans_df)  <span class="co">#Normalizing its values by the total of each row</span></span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="co">## Converting the normalized float values to percentual int values:</span></span>
<span id="cb83-7"><a href="#cb83-7"></a>dist_loans_df <span class="op">=</span> (dist_loans_df<span class="op">*</span><span class="dv">100</span>).astype(<span class="bu">float</span>).applymap(<span class="st">'{:,.2f}'</span>.<span class="bu">format</span>)<span class="co">#</span></span>
<span id="cb83-8"><a href="#cb83-8"></a>dist_loans_df.head (n<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="758">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>status_desc</th>
      <th>Contract finised, loan was not paid</th>
      <th>Contract finished, no problem</th>
      <th>Runing contract, OK so far</th>
      <th>Runing contract, client in debt</th>
    </tr>
    <tr>
      <th>A2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Benesov</th>
      <td>0.00</td>
      <td>16.67</td>
      <td>83.33</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Beroun</th>
      <td>0.00</td>
      <td>16.67</td>
      <td>50.00</td>
      <td>33.33</td>
    </tr>
    <tr>
      <th>Blansko</th>
      <td>0.00</td>
      <td>42.86</td>
      <td>42.86</td>
      <td>14.29</td>
    </tr>
    <tr>
      <th>Breclav</th>
      <td>14.29</td>
      <td>14.29</td>
      <td>71.43</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Brno - mesto</th>
      <td>8.33</td>
      <td>16.67</td>
      <td>62.50</td>
      <td>12.50</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="759">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a><span class="co">#converting df columns dtype into float16 so to make it visible in the heatmap. </span></span>
<span id="cb84-2"><a href="#cb84-2"></a>dist_loans_df <span class="op">=</span> dist_loans_df.astype(np.float16)</span>
<span id="cb84-3"><a href="#cb84-3"></a>dist_loans_df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="759">
<pre><code>status_desc
Contract finised, loan was not paid    float16
Contract finished, no problem          float16
Runing contract, OK so far             float16
Runing contract, client in debt        float16
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="760">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># Drawing a heatmap with the numeric values in each cell</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>fig3, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">25</span>))</span>
<span id="cb86-3"><a href="#cb86-3"></a>fig3.subplots_adjust(top<span class="op">=</span><span class="fl">.965</span>)</span>
<span id="cb86-4"><a href="#cb86-4"></a>plt.suptitle(<span class="st">'Relative loans status distributed by districts'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb86-5"><a href="#cb86-5"></a></span>
<span id="cb86-6"><a href="#cb86-6"></a>cbar_kws <span class="op">=</span> {<span class="st">'orientation'</span>:<span class="st">"horizontal"</span>, <span class="st">'pad'</span>:<span class="fl">0.13</span>, <span class="st">'aspect'</span>:<span class="dv">50</span>}</span>
<span id="cb86-7"><a href="#cb86-7"></a>sns.heatmap(dist_loans_df, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, linewidths<span class="op">=</span><span class="fl">.3</span>, cmap<span class="op">=</span><span class="st">'RdPu'</span>, ax<span class="op">=</span>ax, cbar_kws<span class="op">=</span>cbar_kws )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="business-questions-part-3-loans-insight-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-3-loans-insight-conclusion">Business questions part #3 (loans insight) conclusion:</h3>
<ul>
<li>Generally higher monthly payments tied with unpaid or overdue loans.</li>
<li>From the correlation matrix we can conclude that longer duration slightly increases probability for a loan to be delinquent.</li>
<li>We can see that higher amount of monthly payment correlated with overdue/unpaid debts at the same time lower amount in most of the cases stands for diligent case.<br>
</li>
<li><strong>Cases in branches of following districts should be investigated for subject of potential scam or not duly managed credit risks: Strakonice, Sokolov, Opava, Kutna Hora, Klatovy, Domazlice, Bruntal, Beroun. In those districts number of problematic debts is more than 30%.</strong></li>
</ul>
</section>
<section id="business-questions-part-4-transactions" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-4-transactions">Business questions part #4: transactions</h3>
<ul>
<li>Transaction types distribution in the dataset<br>
</li>
<li>Possible trends and patterns in transactions distribution within given period (1993-1998). Is there any type of trx that was less popular and it’s number growed within time?<br>
</li>
<li>Closer look into funds transfer from and to another banks. Is the overall balance positive? Are there any trends with the balance in the given period?</li>
</ul>
<div class="cell" data-execution_count="761">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="co">#take a look to the subset where operation values are missing</span></span>
<span id="cb87-2"><a href="#cb87-2"></a></span>
<span id="cb87-3"><a href="#cb87-3"></a>trans_opermis_df <span class="op">=</span> trans_df [trans_df [<span class="st">'operation'</span>].isnull ()] [trans_df.columns]</span>
<span id="cb87-4"><a href="#cb87-4"></a>trans_opermis_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="761">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>137</th>
      <td>3591421</td>
      <td>1844</td>
      <td>1993-01-31</td>
      <td>PRIJEM</td>
      <td>NaN</td>
      <td>12.6</td>
      <td>3754.6</td>
      <td>UROK</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>138</th>
      <td>3617490</td>
      <td>2632</td>
      <td>1993-01-31</td>
      <td>PRIJEM</td>
      <td>NaN</td>
      <td>47.5</td>
      <td>15411.5</td>
      <td>UROK</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>139</th>
      <td>3579543</td>
      <td>1493</td>
      <td>1993-01-31</td>
      <td>PRIJEM</td>
      <td>NaN</td>
      <td>13.3</td>
      <td>5222.3</td>
      <td>UROK</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="762">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a><span class="co">#interpretation why it is missing</span></span>
<span id="cb88-2"><a href="#cb88-2"></a></span>
<span id="cb88-3"><a href="#cb88-3"></a>trans_opermis_df.groupby (<span class="st">'type'</span>, axis <span class="op">=</span><span class="dv">0</span>).count ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="762">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
    </tr>
    <tr>
      <th>type</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PRIJEM</th>
      <td>183114</td>
      <td>183114</td>
      <td>183114</td>
      <td>0</td>
      <td>183114</td>
      <td>183114</td>
      <td>183114</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="763">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a>trans_opermis_df.groupby (<span class="st">'k_symbol'</span>, axis <span class="op">=</span><span class="dv">0</span>).count ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="763">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>bank</th>
      <th>account</th>
    </tr>
    <tr>
      <th>k_symbol</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>UROK</th>
      <td>183114</td>
      <td>183114</td>
      <td>183114</td>
      <td>183114</td>
      <td>0</td>
      <td>183114</td>
      <td>183114</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>It appeared that the only possible value in k_symbol for the subset is “UROK” which stands for “interest credited”. We can conclude that operation values are missing since those are transactions “interest credited”, it cannot be filled with any operation type like case withdrawal, remittance or anything else. We can substitute missing values in “operation” with new value “interest_credit”.</p>
<div class="cell" data-execution_count="764">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a><span class="co">#substituting missing values in "operation"</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>trans_df [<span class="st">'operation'</span>].fillna (<span class="st">'INTEREST_CREDIT'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb90-3"><a href="#cb90-3"></a></span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="co">#filling all missing values as np.NaN</span></span>
<span id="cb90-5"><a href="#cb90-5"></a>trans_df.fillna (np.NaN, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb90-6"><a href="#cb90-6"></a></span>
<span id="cb90-7"><a href="#cb90-7"></a>trans_df.isnull ().<span class="bu">sum</span> ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="764">
<pre><code>trans_id           0
account_id         0
date               0
type               0
operation          0
amount             0
balance            0
k_symbol      481881
bank          782812
account       760931
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="765">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a><span class="co">#transactions popularity for the whole reported period </span></span>
<span id="cb92-2"><a href="#cb92-2"></a></span>
<span id="cb92-3"><a href="#cb92-3"></a>trans_count <span class="op">=</span> Counter (trans_df [<span class="st">'operation'</span>])</span>
<span id="cb92-4"><a href="#cb92-4"></a></span>
<span id="cb92-5"><a href="#cb92-5"></a>trans_counts <span class="op">=</span> pd.DataFrame.from_dict (trans_count, orient <span class="op">=</span> <span class="st">'index'</span>)</span>
<span id="cb92-6"><a href="#cb92-6"></a>trans_counts.columns <span class="op">=</span> [<span class="st">'Percentage_ratio'</span>]</span>
<span id="cb92-7"><a href="#cb92-7"></a>trans_counts <span class="op">=</span> trans_counts <span class="op">/</span> (trans_counts [<span class="st">'Percentage_ratio'</span>].<span class="bu">sum</span> ()) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb92-8"><a href="#cb92-8"></a></span>
<span id="cb92-9"><a href="#cb92-9"></a><span class="co">#renaming indices </span></span>
<span id="cb92-10"><a href="#cb92-10"></a>trans_counts.rename (index <span class="op">=</span> {<span class="st">'VKLAD'</span>:<span class="st">'Credit in cash'</span>, <span class="st">'PREVOD Z UCTU'</span>:<span class="st">'Collection from another bank'</span>, <span class="st">'VYBER'</span>:<span class="st">'Withdrawal in cash'</span>,</span>
<span id="cb92-11"><a href="#cb92-11"></a>                             <span class="st">'INTEREST_CREDIT'</span>:<span class="st">'Interest credit'</span>, <span class="st">'PREVOD NA UCET'</span>:<span class="st">'Remittance to another bank'</span>, </span>
<span id="cb92-12"><a href="#cb92-12"></a>                             <span class="st">'VYBER KARTOU'</span>:<span class="st">'Withdrawal from credit card'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)<span class="co">#, , , </span></span>
<span id="cb92-13"><a href="#cb92-13"></a>                            <span class="co">#'Remittance to another bank', ], inplace = True)</span></span>
<span id="cb92-14"><a href="#cb92-14"></a></span>
<span id="cb92-15"><a href="#cb92-15"></a>trans_counts.plot (kind <span class="op">=</span> <span class="st">'bar'</span>,</span>
<span id="cb92-16"><a href="#cb92-16"></a>                    title <span class="op">=</span> <span class="st">'Transaction types distribution'</span>,</span>
<span id="cb92-17"><a href="#cb92-17"></a>                    width <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span id="cb92-18"><a href="#cb92-18"></a>                    figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="fl">5.8</span>),</span>
<span id="cb92-19"><a href="#cb92-19"></a>                    subplots <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb92-20"><a href="#cb92-20"></a>                    color <span class="op">=</span> [plt.cm.Paired(np.arange(<span class="bu">len</span>(region_counts)))]</span>
<span id="cb92-21"><a href="#cb92-21"></a>                    )</span>
<span id="cb92-22"><a href="#cb92-22"></a>trans_counts <span class="co">#pd.DataFrame (list(trans_count.items ())) #/trans_df.shape [0]*100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="765">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Percentage_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Credit in cash</th>
      <td>14.838591</td>
    </tr>
    <tr>
      <th>Collection from another bank</th>
      <td>6.174833</td>
    </tr>
    <tr>
      <th>Withdrawal in cash</th>
      <td>41.172940</td>
    </tr>
    <tr>
      <th>Interest credit</th>
      <td>17.335088</td>
    </tr>
    <tr>
      <th>Remittance to another bank</th>
      <td>19.717794</td>
    </tr>
    <tr>
      <th>Withdrawal from credit card</th>
      <td>0.760754</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-58-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="766">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="co">#adding a column indicating a year when a transaction was performed </span></span>
<span id="cb93-2"><a href="#cb93-2"></a>trans_df [<span class="st">'tran_year'</span>] <span class="op">=</span> trans_df [<span class="st">'date'</span>]</span>
<span id="cb93-3"><a href="#cb93-3"></a>trans_df [<span class="st">'tran_year'</span>] <span class="op">=</span> trans_df [<span class="st">'tran_year'</span>].<span class="bu">apply</span> (year_extract)</span>
<span id="cb93-4"><a href="#cb93-4"></a>    </span>
<span id="cb93-5"><a href="#cb93-5"></a>trans_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="766">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="767">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a><span class="co">#grouping by tran_year and operation, then counting number of transactions  </span></span>
<span id="cb94-2"><a href="#cb94-2"></a>year_trantype_df <span class="op">=</span> pd.DataFrame (trans_df.groupby ([<span class="st">'tran_year'</span>, <span class="st">'operation'</span>], axis <span class="op">=</span> <span class="dv">0</span>) [<span class="st">'operation'</span>].count ())</span>
<span id="cb94-3"><a href="#cb94-3"></a></span>
<span id="cb94-4"><a href="#cb94-4"></a><span class="co">#naming column as 'count' </span></span>
<span id="cb94-5"><a href="#cb94-5"></a>year_trantype_df.columns <span class="op">=</span> [<span class="st">'count'</span>]</span>
<span id="cb94-6"><a href="#cb94-6"></a></span>
<span id="cb94-7"><a href="#cb94-7"></a><span class="co">#making columns out of multi-index of tran_year and operation so to make it easier to operate with values</span></span>
<span id="cb94-8"><a href="#cb94-8"></a>year_trantype_df.reset_index (level<span class="op">=</span> [<span class="st">'operation'</span>, <span class="st">'tran_year'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb94-9"><a href="#cb94-9"></a></span>
<span id="cb94-10"><a href="#cb94-10"></a>display (year_trantype_df .head (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>tran_year</th>
      <th>operation</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1993</td>
      <td>INTEREST_CREDIT</td>
      <td>6065</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1993</td>
      <td>PREVOD NA UCET</td>
      <td>3231</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1993</td>
      <td>PREVOD Z UCTU</td>
      <td>2462</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="768">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a><span class="co">#no values for VYBER KARTOU in 1993 </span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="co">#adding as zero</span></span>
<span id="cb95-3"><a href="#cb95-3"></a></span>
<span id="cb95-4"><a href="#cb95-4"></a>list_of_zer1 <span class="op">=</span> [pd.Series ([<span class="dv">1993</span>, <span class="st">'VYBER KARTOU'</span>, <span class="dv">0</span>], index <span class="op">=</span> year_trantype_df.columns)]</span>
<span id="cb95-5"><a href="#cb95-5"></a>year_trantype_df <span class="op">=</span> year_trantype_df.append (list_of_zer1, ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb95-6"><a href="#cb95-6"></a></span>
<span id="cb95-7"><a href="#cb95-7"></a>year_trantype_df.sort_values ([<span class="st">'tran_year'</span>, <span class="st">'operation'</span>], inplace<span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb95-8"><a href="#cb95-8"></a>year_trantype_df.reset_index (inplace <span class="op">=</span> <span class="va">True</span>, drop <span class="op">=</span> <span class="va">True</span>) <span class="co">#making index start from 0 again</span></span>
<span id="cb95-9"><a href="#cb95-9"></a>display (year_trantype_df .head (n<span class="op">=</span><span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>tran_year</th>
      <th>operation</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1993</td>
      <td>INTEREST_CREDIT</td>
      <td>6065</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1993</td>
      <td>PREVOD NA UCET</td>
      <td>3231</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1993</td>
      <td>PREVOD Z UCTU</td>
      <td>2462</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1993</td>
      <td>VKLAD</td>
      <td>6685</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1993</td>
      <td>VYBER</td>
      <td>9762</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>VYBER KARTOU</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="769">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a><span class="co">#plotting number of transactions per year </span></span>
<span id="cb96-2"><a href="#cb96-2"></a></span>
<span id="cb96-3"><a href="#cb96-3"></a>x <span class="op">=</span> <span class="bu">list</span> (year_trantype_df [<span class="st">'tran_year'</span>].unique()) <span class="co">#years </span></span>
<span id="cb96-4"><a href="#cb96-4"></a>y <span class="op">=</span>  <span class="bu">list</span> (year_trantype_df [year_trantype_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'INTEREST_CREDIT'</span>] [<span class="st">'count'</span>]) </span>
<span id="cb96-5"><a href="#cb96-5"></a>y2 <span class="op">=</span> <span class="bu">list</span> (year_trantype_df [year_trantype_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'PREVOD NA UCET'</span>] [<span class="st">'count'</span>]) </span>
<span id="cb96-6"><a href="#cb96-6"></a>y3 <span class="op">=</span> <span class="bu">list</span> (year_trantype_df [year_trantype_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'PREVOD Z UCTU'</span>] [<span class="st">'count'</span>]) </span>
<span id="cb96-7"><a href="#cb96-7"></a>y4 <span class="op">=</span> <span class="bu">list</span> (year_trantype_df [year_trantype_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'VKLAD'</span>] [<span class="st">'count'</span>]) </span>
<span id="cb96-8"><a href="#cb96-8"></a>y5 <span class="op">=</span> <span class="bu">list</span> (year_trantype_df [year_trantype_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'VYBER'</span>] [<span class="st">'count'</span>]) </span>
<span id="cb96-9"><a href="#cb96-9"></a>y6 <span class="op">=</span> <span class="bu">list</span> (year_trantype_df [year_trantype_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'VYBER KARTOU'</span>] [<span class="st">'count'</span>]) </span>
<span id="cb96-10"><a href="#cb96-10"></a></span>
<span id="cb96-11"><a href="#cb96-11"></a>bar1 <span class="op">=</span> go.Bar(</span>
<span id="cb96-12"><a href="#cb96-12"></a>    x<span class="op">=</span>x,</span>
<span id="cb96-13"><a href="#cb96-13"></a>    y<span class="op">=</span>y,</span>
<span id="cb96-14"><a href="#cb96-14"></a>    text<span class="op">=</span> y,</span>
<span id="cb96-15"><a href="#cb96-15"></a>    name <span class="op">=</span> <span class="st">'Interest credit'</span>,</span>
<span id="cb96-16"><a href="#cb96-16"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb96-17"><a href="#cb96-17"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-18"><a href="#cb96-18"></a>        color<span class="op">=</span><span class="st">'rgb(158,202,225)'</span>,</span>
<span id="cb96-19"><a href="#cb96-19"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-20"><a href="#cb96-20"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb96-21"><a href="#cb96-21"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb96-22"><a href="#cb96-22"></a>        ),</span>
<span id="cb96-23"><a href="#cb96-23"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb96-24"><a href="#cb96-24"></a>)</span>
<span id="cb96-25"><a href="#cb96-25"></a></span>
<span id="cb96-26"><a href="#cb96-26"></a>bar2 <span class="op">=</span> go.Bar(</span>
<span id="cb96-27"><a href="#cb96-27"></a>    x<span class="op">=</span>x,</span>
<span id="cb96-28"><a href="#cb96-28"></a>    y<span class="op">=</span>y2,</span>
<span id="cb96-29"><a href="#cb96-29"></a>    text<span class="op">=</span>y2,</span>
<span id="cb96-30"><a href="#cb96-30"></a>    name <span class="op">=</span> <span class="st">'Remittance to another bank'</span>,</span>
<span id="cb96-31"><a href="#cb96-31"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb96-32"><a href="#cb96-32"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-33"><a href="#cb96-33"></a>        color<span class="op">=</span><span class="st">'rgb(0,100,0)'</span>,</span>
<span id="cb96-34"><a href="#cb96-34"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-35"><a href="#cb96-35"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb96-36"><a href="#cb96-36"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb96-37"><a href="#cb96-37"></a>        ),</span>
<span id="cb96-38"><a href="#cb96-38"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb96-39"><a href="#cb96-39"></a>)</span>
<span id="cb96-40"><a href="#cb96-40"></a></span>
<span id="cb96-41"><a href="#cb96-41"></a>bar3 <span class="op">=</span> go.Bar(</span>
<span id="cb96-42"><a href="#cb96-42"></a>    x<span class="op">=</span>x,</span>
<span id="cb96-43"><a href="#cb96-43"></a>    y<span class="op">=</span>y3,</span>
<span id="cb96-44"><a href="#cb96-44"></a>    text<span class="op">=</span>y3,</span>
<span id="cb96-45"><a href="#cb96-45"></a>    name <span class="op">=</span> <span class="st">'Collection from another bank'</span>,</span>
<span id="cb96-46"><a href="#cb96-46"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb96-47"><a href="#cb96-47"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-48"><a href="#cb96-48"></a>        color<span class="op">=</span><span class="st">'rgb(128,0,128)'</span>,</span>
<span id="cb96-49"><a href="#cb96-49"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-50"><a href="#cb96-50"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb96-51"><a href="#cb96-51"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb96-52"><a href="#cb96-52"></a>        ),</span>
<span id="cb96-53"><a href="#cb96-53"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb96-54"><a href="#cb96-54"></a>)</span>
<span id="cb96-55"><a href="#cb96-55"></a></span>
<span id="cb96-56"><a href="#cb96-56"></a>bar4 <span class="op">=</span> go.Bar(</span>
<span id="cb96-57"><a href="#cb96-57"></a>    x<span class="op">=</span>x,</span>
<span id="cb96-58"><a href="#cb96-58"></a>    y<span class="op">=</span>y4,</span>
<span id="cb96-59"><a href="#cb96-59"></a>    text<span class="op">=</span>y4,</span>
<span id="cb96-60"><a href="#cb96-60"></a>    name <span class="op">=</span> <span class="st">'Credit in cash'</span>,</span>
<span id="cb96-61"><a href="#cb96-61"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb96-62"><a href="#cb96-62"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-63"><a href="#cb96-63"></a>        color<span class="op">=</span><span class="st">'rgb(0,139,139)'</span>,</span>
<span id="cb96-64"><a href="#cb96-64"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-65"><a href="#cb96-65"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb96-66"><a href="#cb96-66"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb96-67"><a href="#cb96-67"></a>        ),</span>
<span id="cb96-68"><a href="#cb96-68"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb96-69"><a href="#cb96-69"></a>)</span>
<span id="cb96-70"><a href="#cb96-70"></a></span>
<span id="cb96-71"><a href="#cb96-71"></a>bar5 <span class="op">=</span> go.Bar(</span>
<span id="cb96-72"><a href="#cb96-72"></a>    x<span class="op">=</span>x,</span>
<span id="cb96-73"><a href="#cb96-73"></a>    y<span class="op">=</span>y5,</span>
<span id="cb96-74"><a href="#cb96-74"></a>    text<span class="op">=</span>y5,</span>
<span id="cb96-75"><a href="#cb96-75"></a>    name <span class="op">=</span> <span class="st">'Withdrawal in cash'</span>,</span>
<span id="cb96-76"><a href="#cb96-76"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb96-77"><a href="#cb96-77"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-78"><a href="#cb96-78"></a>        color<span class="op">=</span><span class="st">'rgb(255,215,0)'</span>,</span>
<span id="cb96-79"><a href="#cb96-79"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-80"><a href="#cb96-80"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb96-81"><a href="#cb96-81"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb96-82"><a href="#cb96-82"></a>        ),</span>
<span id="cb96-83"><a href="#cb96-83"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb96-84"><a href="#cb96-84"></a>)</span>
<span id="cb96-85"><a href="#cb96-85"></a></span>
<span id="cb96-86"><a href="#cb96-86"></a>bar6 <span class="op">=</span> go.Bar(</span>
<span id="cb96-87"><a href="#cb96-87"></a>    x<span class="op">=</span>x,</span>
<span id="cb96-88"><a href="#cb96-88"></a>    y<span class="op">=</span>y6,</span>
<span id="cb96-89"><a href="#cb96-89"></a>    text<span class="op">=</span>y6,</span>
<span id="cb96-90"><a href="#cb96-90"></a>    name <span class="op">=</span> <span class="st">'Withdrawal from credit card'</span>,</span>
<span id="cb96-91"><a href="#cb96-91"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb96-92"><a href="#cb96-92"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-93"><a href="#cb96-93"></a>        color<span class="op">=</span><span class="st">'rgb(255,0,0)'</span>,</span>
<span id="cb96-94"><a href="#cb96-94"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb96-95"><a href="#cb96-95"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb96-96"><a href="#cb96-96"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb96-97"><a href="#cb96-97"></a>        ),</span>
<span id="cb96-98"><a href="#cb96-98"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb96-99"><a href="#cb96-99"></a>)</span>
<span id="cb96-100"><a href="#cb96-100"></a></span>
<span id="cb96-101"><a href="#cb96-101"></a>data <span class="op">=</span> [bar1, bar2, bar3, bar4, bar5, bar6]</span>
<span id="cb96-102"><a href="#cb96-102"></a></span>
<span id="cb96-103"><a href="#cb96-103"></a>py.iplot(data, filename<span class="op">=</span><span class="st">'grouped-bar-direct-labels'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ca4824d2-bdb3-473b-b222-a025c15ea172" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("ca4824d2-bdb3-473b-b222-a025c15ea172", [{"marker": {"color": "rgb(158,202,225)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Interest credit", "opacity": 0.6, "text": ["6065", "16181", "22903", "34548", "48788", "54629"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [6065, 16181, 22903, 34548, 48788, 54629], "type": "bar", "uid": "3d0ccbcb-fe5c-4e6c-bad7-af597ad432f0"}, {"marker": {"color": "rgb(0,100,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Remittance to another bank", "opacity": 0.6, "text": ["3231", "16980", "25763", "37270", "56270", "68769"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [3231, 16980, 25763, 37270, 56270, 68769], "type": "bar", "uid": "84ca5402-ed25-40db-a1c5-9735107be32a"}, {"marker": {"color": "rgb(128,0,128)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Collection from another bank", "opacity": 0.6, "text": ["2462", "5885", "8185", "12160", "17262", "19272"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [2462, 5885, 8185, 12160, 17262, 19272], "type": "bar", "uid": "f575d549-b890-452d-a65f-2332d0e6a616"}, {"marker": {"color": "rgb(0,139,139)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Credit in cash", "opacity": 0.6, "text": ["6685", "13677", "19545", "30256", "41628", "44952"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [6685, 13677, 19545, 30256, 41628, 44952], "type": "bar", "uid": "8bc2ef89-4ba2-4466-8572-70794166c07d"}, {"marker": {"color": "rgb(255,215,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Withdrawal in cash", "opacity": 0.6, "text": ["9762", "38840", "56307", "81619", "118295", "130095"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [9762, 38840, 56307, 81619, 118295, 130095], "type": "bar", "uid": "d64fab4b-6f5a-495b-835f-e2f9ed73583b"}, {"marker": {"color": "rgb(255,0,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Withdrawal from credit card", "opacity": 0.6, "text": ["0", "65", "319", "926", "2166", "4560"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [0, 65, 319, 926, 2166, 4560], "type": "bar", "uid": "1466cb48-8e58-4b3f-9668-fdba370b09bc"}], {}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script><script type="text/javascript">window.addEventListener("resize", function(){window._Plotly.Plots.resize(document.getElementById("ca4824d2-bdb3-473b-b222-a025c15ea172"));});</script>
</div>
</div>
<div class="cell" data-execution_count="770">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="co">#investigating transactions marked as "collection from another bank" </span></span>
<span id="cb97-2"><a href="#cb97-2"></a></span>
<span id="cb97-3"><a href="#cb97-3"></a>trans_col_df <span class="op">=</span> trans_df [trans_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'PREVOD Z UCTU'</span>]</span>
<span id="cb97-4"><a href="#cb97-4"></a></span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="co">#unique values in the column k_symbol which will describe possible reason for collection</span></span>
<span id="cb97-6"><a href="#cb97-6"></a>trans_col_df [<span class="st">'k_symbol'</span>].unique ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="770">
<pre><code>array(['DUCHOD', nan], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="771">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a><span class="co">#checking proportion of each possible value: DUCHOD ( old-age pension) and NaNs</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>pd.DataFrame(Counter (trans_col_df [<span class="st">'k_symbol'</span>]), index <span class="op">=</span> [<span class="dv">0</span>]).transpose () <span class="op">/</span> trans_col_df.shape [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="771">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DUCHOD</th>
      <td>46.512127</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>53.487873</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From the above we can conclude that 46.5% of “collection from another bank” transactions stands for old-age pension and 53.5% transactions were not specifically identified which may related to funds transfers between clients.</p>
<div class="cell" data-execution_count="772">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>trans_col_df [trans_col_df [<span class="st">'k_symbol'</span>] <span class="op">==</span> <span class="st">'DUCHOD'</span>] [<span class="st">'amount'</span>].<span class="bu">sum</span> ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="772">
<pre><code>167472118.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="773">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a>trans_col_df [trans_col_df [<span class="st">'k_symbol'</span>] <span class="op">!=</span> <span class="st">'DUCHOD'</span>] [<span class="st">'amount'</span>].<span class="bu">sum</span> ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="773">
<pre><code>614007835.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="774">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a><span class="co">#investigating transactions marked as "remittance to another bank"</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>trans_rem_df <span class="op">=</span> trans_df [trans_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'PREVOD NA UCET'</span>]</span>
<span id="cb104-3"><a href="#cb104-3"></a></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="co">#unique values in the column k_symbol which will describe possible reason for collection</span></span>
<span id="cb104-5"><a href="#cb104-5"></a>trans_rem_df [<span class="st">'k_symbol'</span>].unique ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="774">
<pre><code>array(['SIPO', ' ', 'POJISTNE', nan, 'UVER'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="775">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a><span class="co">#filling spaces in k_symbol with NaN</span></span>
<span id="cb106-2"><a href="#cb106-2"></a>trans_rem_df <span class="op">=</span> trans_rem_df.replace(<span class="vs">r'^\s*$'</span>, np.nan, regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="776">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a><span class="co">#verifying result </span></span>
<span id="cb107-2"><a href="#cb107-2"></a>trans_rem_df [<span class="st">'k_symbol'</span>].unique ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="776">
<pre><code>array(['SIPO', nan, 'POJISTNE', 'UVER'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="777">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a><span class="co">#checking proportion of each possible value for remittance transactions</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>pd.DataFrame(Counter (trans_rem_df [<span class="st">'k_symbol'</span>]), index <span class="op">=</span> [<span class="dv">0</span>]).transpose () <span class="op">/</span> trans_rem_df.shape [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="777">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SIPO</th>
      <td>55.335289</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>29.273633</td>
    </tr>
    <tr>
      <th>POJISTNE</th>
      <td>8.871103</td>
    </tr>
    <tr>
      <th>UVER</th>
      <td>6.519975</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From the above we see that majority (55.3%) of remittance transactions related to household payments, on the second place (29.3%) payment reason unknown, on the third (8.9%) - insurance payments, on the last place (6.5%) - loan payments.</p>
<div class="cell" data-execution_count="778">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a><span class="co">#verifying positive/negative balance between collection from another banks and remittance to another banks</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>trans_colrem_df <span class="op">=</span> trans_col_df.append (trans_rem_df)</span>
<span id="cb110-3"><a href="#cb110-3"></a></span>
<span id="cb110-4"><a href="#cb110-4"></a><span class="co">#overall balance of incoming (PREVOD Z UCTU) and outgoing (PREVOD NA UCET)</span></span>
<span id="cb110-5"><a href="#cb110-5"></a>display (pd.DataFrame (trans_colrem_df.groupby ([<span class="st">'operation'</span>]).<span class="bu">sum</span> () [<span class="st">'amount'</span>].sort_values ()))</span>
<span id="cb110-6"><a href="#cb110-6"></a></span>
<span id="cb110-7"><a href="#cb110-7"></a><span class="co">#proportion </span></span>
<span id="cb110-8"><a href="#cb110-8"></a>display (pd.DataFrame (trans_colrem_df.groupby ([<span class="st">'operation'</span>]).<span class="bu">sum</span> () [<span class="st">'amount'</span>].sort_values ())<span class="op">/</span>trans_colrem_df [<span class="st">'amount'</span>].<span class="bu">sum</span> () <span class="op">*</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>amount</th>
    </tr>
    <tr>
      <th>operation</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PREVOD NA UCET</th>
      <td>672637786.3</td>
    </tr>
    <tr>
      <th>PREVOD Z UCTU</th>
      <td>781479953.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>amount</th>
    </tr>
    <tr>
      <th>operation</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PREVOD NA UCET</th>
      <td>46.25745</td>
    </tr>
    <tr>
      <th>PREVOD Z UCTU</th>
      <td>53.74255</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="779">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a><span class="co">#mean of remittance and collection </span></span>
<span id="cb111-2"><a href="#cb111-2"></a>display (pd.DataFrame (trans_colrem_df.groupby ([<span class="st">'operation'</span>]).mean () [<span class="st">'amount'</span>].sort_values ()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>amount</th>
    </tr>
    <tr>
      <th>operation</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PREVOD NA UCET</th>
      <td>3229.441607</td>
    </tr>
    <tr>
      <th>PREVOD Z UCTU</th>
      <td>11981.111106</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From 1993 to 1998 overall balance is positive: received amount is bigger for 7.5% comparing to outgoing.</p>
<div class="cell" data-execution_count="780">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a><span class="co">#now let's take a look if there is any trend from 1993 to 1998 in the amounts for remittance and collection</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>year_transfer_df <span class="op">=</span> pd.DataFrame (trans_colrem_df.groupby ([<span class="st">'operation'</span>,<span class="st">'tran_year'</span>], axis <span class="op">=</span> <span class="dv">0</span>) [<span class="st">'amount'</span>] .<span class="bu">sum</span> ().sort_values ())</span>
<span id="cb112-3"><a href="#cb112-3"></a></span>
<span id="cb112-4"><a href="#cb112-4"></a><span class="co">#naming column as 'sum' </span></span>
<span id="cb112-5"><a href="#cb112-5"></a>year_transfer_df.columns <span class="op">=</span> [<span class="st">'sum'</span>]</span>
<span id="cb112-6"><a href="#cb112-6"></a></span>
<span id="cb112-7"><a href="#cb112-7"></a><span class="co">#making columns out of multi-index so to make it easier to operate with values</span></span>
<span id="cb112-8"><a href="#cb112-8"></a>year_transfer_df.reset_index (inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb112-9"><a href="#cb112-9"></a></span>
<span id="cb112-10"><a href="#cb112-10"></a><span class="co">#renaming values in operation so to have better visibility</span></span>
<span id="cb112-11"><a href="#cb112-11"></a>dict11 <span class="op">=</span>  {<span class="st">'PREVOD NA UCET'</span>:<span class="st">'Remittance to another bank'</span>, </span>
<span id="cb112-12"><a href="#cb112-12"></a>      <span class="st">'PREVOD Z UCTU'</span>:<span class="st">'Collection from another bank'</span></span>
<span id="cb112-13"><a href="#cb112-13"></a>     }</span>
<span id="cb112-14"><a href="#cb112-14"></a>year_transfer_df.operation <span class="op">=</span> year_transfer_df.operation.replace (dict11)</span>
<span id="cb112-15"><a href="#cb112-15"></a></span>
<span id="cb112-16"><a href="#cb112-16"></a>display (year_transfer_df .head (n<span class="op">=</span><span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>operation</th>
      <th>tran_year</th>
      <th>sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Remittance to another bank</td>
      <td>1993</td>
      <td>10159410.7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Collection from another bank</td>
      <td>1993</td>
      <td>29809129.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Remittance to another bank</td>
      <td>1994</td>
      <td>53841549.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Collection from another bank</td>
      <td>1994</td>
      <td>68925764.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Remittance to another bank</td>
      <td>1995</td>
      <td>81845324.4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Collection from another bank</td>
      <td>1995</td>
      <td>99242619.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Remittance to another bank</td>
      <td>1996</td>
      <td>119563522.2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Collection from another bank</td>
      <td>1996</td>
      <td>146015899.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Remittance to another bank</td>
      <td>1997</td>
      <td>182443823.2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Collection from another bank</td>
      <td>1997</td>
      <td>207339926.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Remittance to another bank</td>
      <td>1998</td>
      <td>224784156.7</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Collection from another bank</td>
      <td>1998</td>
      <td>230146616.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="781">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a><span class="co">#plotting sum of remittance and collection per years </span></span>
<span id="cb113-2"><a href="#cb113-2"></a>x <span class="op">=</span> <span class="bu">list</span> (year_transfer_df [<span class="st">'tran_year'</span>].unique()) <span class="co">#years </span></span>
<span id="cb113-3"><a href="#cb113-3"></a>y <span class="op">=</span>  <span class="bu">list</span> (year_transfer_df [year_transfer_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'Remittance to another bank'</span>] [<span class="st">'sum'</span>]) </span>
<span id="cb113-4"><a href="#cb113-4"></a>y2 <span class="op">=</span> <span class="bu">list</span> (year_transfer_df [year_transfer_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'Collection from another bank'</span>] [<span class="st">'sum'</span>]) </span>
<span id="cb113-5"><a href="#cb113-5"></a></span>
<span id="cb113-6"><a href="#cb113-6"></a>bar2 <span class="op">=</span> go.Bar(</span>
<span id="cb113-7"><a href="#cb113-7"></a>    x<span class="op">=</span>x,</span>
<span id="cb113-8"><a href="#cb113-8"></a>    y<span class="op">=</span>y,</span>
<span id="cb113-9"><a href="#cb113-9"></a>    text<span class="op">=</span>y,</span>
<span id="cb113-10"><a href="#cb113-10"></a>    name <span class="op">=</span> <span class="st">'Remittance to another bank'</span>,</span>
<span id="cb113-11"><a href="#cb113-11"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb113-12"><a href="#cb113-12"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb113-13"><a href="#cb113-13"></a>        color<span class="op">=</span><span class="st">'rgb(0,100,0)'</span>,</span>
<span id="cb113-14"><a href="#cb113-14"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb113-15"><a href="#cb113-15"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb113-16"><a href="#cb113-16"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb113-17"><a href="#cb113-17"></a>        ),</span>
<span id="cb113-18"><a href="#cb113-18"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb113-19"><a href="#cb113-19"></a>)</span>
<span id="cb113-20"><a href="#cb113-20"></a>bar5 <span class="op">=</span> go.Bar(</span>
<span id="cb113-21"><a href="#cb113-21"></a>    x<span class="op">=</span>x,</span>
<span id="cb113-22"><a href="#cb113-22"></a>    y<span class="op">=</span>y2,</span>
<span id="cb113-23"><a href="#cb113-23"></a>    text<span class="op">=</span>y2,</span>
<span id="cb113-24"><a href="#cb113-24"></a>    name <span class="op">=</span> <span class="st">'Collection from another bank'</span>,</span>
<span id="cb113-25"><a href="#cb113-25"></a>    textposition <span class="op">=</span> <span class="st">'auto'</span>,</span>
<span id="cb113-26"><a href="#cb113-26"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb113-27"><a href="#cb113-27"></a>        color<span class="op">=</span><span class="st">'rgb(255,215,0)'</span>,</span>
<span id="cb113-28"><a href="#cb113-28"></a>        line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb113-29"><a href="#cb113-29"></a>            color<span class="op">=</span><span class="st">'rgb(8,48,107)'</span>,</span>
<span id="cb113-30"><a href="#cb113-30"></a>            width<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb113-31"><a href="#cb113-31"></a>        ),</span>
<span id="cb113-32"><a href="#cb113-32"></a>    opacity<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb113-33"><a href="#cb113-33"></a>)</span>
<span id="cb113-34"><a href="#cb113-34"></a>data <span class="op">=</span> [bar2, bar5]</span>
<span id="cb113-35"><a href="#cb113-35"></a>py.iplot(data, filename<span class="op">=</span><span class="st">'grouped-bar-direct-labels'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="89c2add8-1b16-4f3e-afca-37641bbca7d6" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("89c2add8-1b16-4f3e-afca-37641bbca7d6", [{"marker": {"color": "rgb(0,100,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Remittance to another bank", "opacity": 0.6, "text": ["10159410.7", "53841549.09999997", "81845324.39999995", "119563522.20000014", "182443823.19999987", "224784156.69999987"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [10159410.7, 53841549.09999997, 81845324.39999995, 119563522.20000014, 182443823.19999987, 224784156.69999987], "type": "bar", "uid": "80acd317-0b5e-47b0-a1f3-7d462267f7b4"}, {"marker": {"color": "rgb(255,215,0)", "line": {"color": "rgb(8,48,107)", "width": 1.5}}, "name": "Collection from another bank", "opacity": 0.6, "text": ["29809129.0", "68925764.0", "99242619.0", "146015899.0", "207339926.0", "230146616.0"], "textposition": "auto", "x": [1993, 1994, 1995, 1996, 1997, 1998], "y": [29809129.0, 68925764.0, 99242619.0, 146015899.0, 207339926.0, 230146616.0], "type": "bar", "uid": "02242153-d5c5-4915-8cf2-ca9721db2e9f"}], {}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})});</script><script type="text/javascript">window.addEventListener("resize", function(){window._Plotly.Plots.resize(document.getElementById("89c2add8-1b16-4f3e-afca-37641bbca7d6"));});</script>
</div>
</div>
<div class="cell" data-execution_count="782">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a><span class="co">#a dataframe for plotting remittance and colletion by months distribution</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>trans_remcol_df <span class="op">=</span> trans_colrem_df.copy ()</span>
<span id="cb114-3"><a href="#cb114-3"></a></span>
<span id="cb114-4"><a href="#cb114-4"></a><span class="co">#columns with amounts that affects balance positively - collection from another banks </span></span>
<span id="cb114-5"><a href="#cb114-5"></a>trans_remcol_df <span class="op">=</span> trans_remcol_df.assign (pos_sum <span class="op">=</span> np.nan)</span>
<span id="cb114-6"><a href="#cb114-6"></a></span>
<span id="cb114-7"><a href="#cb114-7"></a><span class="co">#columns with amounts that affects balance negatively - remittance to another banks</span></span>
<span id="cb114-8"><a href="#cb114-8"></a>trans_remcol_df <span class="op">=</span> trans_remcol_df.assign (neg_sum <span class="op">=</span> np.nan)</span>
<span id="cb114-9"><a href="#cb114-9"></a></span>
<span id="cb114-10"><a href="#cb114-10"></a><span class="co">#filling columns pos_sum and neg_sum based on operation type. pos_sum stands for inflows</span></span>
<span id="cb114-11"><a href="#cb114-11"></a>trans_remcol_df.pos_sum <span class="op">=</span> trans_remcol_df.amount.where (trans_remcol_df.operation <span class="op">==</span> <span class="st">'PREVOD Z UCTU'</span>, trans_remcol_df.pos_sum)</span>
<span id="cb114-12"><a href="#cb114-12"></a></span>
<span id="cb114-13"><a href="#cb114-13"></a><span class="co">#neg_sum stands for outflows</span></span>
<span id="cb114-14"><a href="#cb114-14"></a>trans_remcol_df.neg_sum <span class="op">=</span> trans_remcol_df.amount.where (trans_remcol_df.operation <span class="op">==</span> <span class="st">'PREVOD NA UCET'</span>, trans_remcol_df.neg_sum )</span>
<span id="cb114-15"><a href="#cb114-15"></a></span>
<span id="cb114-16"><a href="#cb114-16"></a>display (trans_remcol_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb114-17"><a href="#cb114-17"></a>trans_remcol_df [trans_remcol_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'PREVOD Z UCTU'</span>].tail (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>pos_sum</th>
      <th>neg_sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>637742</td>
      <td>2177</td>
      <td>1993-01-05</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>5123.0</td>
      <td>5923.0</td>
      <td>DUCHOD</td>
      <td>YZ</td>
      <td>62457513.0</td>
      <td>1993</td>
      <td>5123.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>17</th>
      <td>232961</td>
      <td>793</td>
      <td>1993-01-05</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>3401.0</td>
      <td>4201.0</td>
      <td>NaN</td>
      <td>IJ</td>
      <td>6149286.0</td>
      <td>1993</td>
      <td>3401.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>21</th>
      <td>542216</td>
      <td>1844</td>
      <td>1993-01-07</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>3242.0</td>
      <td>3742.0</td>
      <td>NaN</td>
      <td>ST</td>
      <td>42988401.0</td>
      <td>1993</td>
      <td>3242.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="782">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>pos_sum</th>
      <th>neg_sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1047122</th>
      <td>546460</td>
      <td>1860</td>
      <td>1998-12-14</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>3255.0</td>
      <td>20916.3</td>
      <td>NaN</td>
      <td>MN</td>
      <td>61854898.0</td>
      <td>1998</td>
      <td>3255.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1047127</th>
      <td>605757</td>
      <td>2062</td>
      <td>1998-12-14</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>64642.0</td>
      <td>97552.6</td>
      <td>NaN</td>
      <td>EF</td>
      <td>10179949.0</td>
      <td>1998</td>
      <td>64642.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1047137</th>
      <td>519257</td>
      <td>1773</td>
      <td>1998-12-14</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>4316.0</td>
      <td>17215.9</td>
      <td>DUCHOD</td>
      <td>CD</td>
      <td>77385341.0</td>
      <td>1998</td>
      <td>4316.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="783">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a><span class="co">#we need a pandas.DateTimeIndex for resampling</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>trans_remcol_df.set_index (trans_remcol_df [<span class="st">'date'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb115-3"><a href="#cb115-3"></a>trans_remcol_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="783">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>pos_sum</th>
      <th>neg_sum</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1993-01-05</th>
      <td>637742</td>
      <td>2177</td>
      <td>1993-01-05</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>5123.0</td>
      <td>5923.0</td>
      <td>DUCHOD</td>
      <td>YZ</td>
      <td>62457513.0</td>
      <td>1993</td>
      <td>5123.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993-01-05</th>
      <td>232961</td>
      <td>793</td>
      <td>1993-01-05</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>3401.0</td>
      <td>4201.0</td>
      <td>NaN</td>
      <td>IJ</td>
      <td>6149286.0</td>
      <td>1993</td>
      <td>3401.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993-01-07</th>
      <td>542216</td>
      <td>1844</td>
      <td>1993-01-07</td>
      <td>PRIJEM</td>
      <td>PREVOD Z UCTU</td>
      <td>3242.0</td>
      <td>3742.0</td>
      <td>NaN</td>
      <td>ST</td>
      <td>42988401.0</td>
      <td>1993</td>
      <td>3242.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="784">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a><span class="co">#plotting results with aggregation on the level of years</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>inflows <span class="op">=</span> trans_remcol_df[<span class="st">'pos_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb116-3"><a href="#cb116-3"></a>outflows <span class="op">=</span> trans_remcol_df[<span class="st">'neg_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb116-4"><a href="#cb116-4"></a></span>
<span id="cb116-5"><a href="#cb116-5"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb116-6"><a href="#cb116-6"></a>x <span class="op">=</span> outflows.index</span>
<span id="cb116-7"><a href="#cb116-7"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb116-8"><a href="#cb116-8"></a>y1 <span class="op">=</span> <span class="bu">list</span> (inflows <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb116-9"><a href="#cb116-9"></a>y2 <span class="op">=</span> <span class="bu">list</span> (outflows <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb116-10"><a href="#cb116-10"></a></span>
<span id="cb116-11"><a href="#cb116-11"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb116-12"><a href="#cb116-12"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Collection'</span>)</span>
<span id="cb116-13"><a href="#cb116-13"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Remittance'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb116-14"><a href="#cb116-14"></a>ax.set_title(<span class="st">"Collection from and remittance to another banks (years)"</span>)</span>
<span id="cb116-15"><a href="#cb116-15"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb116-16"><a href="#cb116-16"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="785">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a><span class="co">#plotting results with aggregation on the level of months</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>inflows <span class="op">=</span> trans_remcol_df[<span class="st">'pos_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb117-3"><a href="#cb117-3"></a>outflows <span class="op">=</span> trans_remcol_df[<span class="st">'neg_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb117-4"><a href="#cb117-4"></a></span>
<span id="cb117-5"><a href="#cb117-5"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb117-6"><a href="#cb117-6"></a>x <span class="op">=</span> outflows.index</span>
<span id="cb117-7"><a href="#cb117-7"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb117-8"><a href="#cb117-8"></a>y1 <span class="op">=</span> <span class="bu">list</span> (inflows <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb117-9"><a href="#cb117-9"></a>y2 <span class="op">=</span> <span class="bu">list</span> (outflows <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb117-10"><a href="#cb117-10"></a></span>
<span id="cb117-11"><a href="#cb117-11"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb117-12"><a href="#cb117-12"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Collection'</span>)</span>
<span id="cb117-13"><a href="#cb117-13"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Remittance'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb117-14"><a href="#cb117-14"></a>ax.set_title(<span class="st">"Collection from and remittance to another banks (months)"</span>)</span>
<span id="cb117-15"><a href="#cb117-15"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb117-16"><a href="#cb117-16"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-78-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="786">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a><span class="co">#complementing trans_df with account data and district data</span></span>
<span id="cb118-2"><a href="#cb118-2"></a>trans_acc_df <span class="op">=</span> trans_df.copy ()</span>
<span id="cb118-3"><a href="#cb118-3"></a>trans_acc_df <span class="op">=</span> trans_acc_df.merge (accounts_df, left_on <span class="op">=</span> <span class="st">'account_id'</span>, right_on <span class="op">=</span> <span class="st">'account_id'</span>, </span>
<span id="cb118-4"><a href="#cb118-4"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>) </span>
<span id="cb118-5"><a href="#cb118-5"></a>trans_acc_dist_df <span class="op">=</span> trans_acc_df.merge (district_df, left_on <span class="op">=</span> <span class="st">'district_id'</span>, right_on <span class="op">=</span> <span class="st">'A1'</span>, </span>
<span id="cb118-6"><a href="#cb118-6"></a>                                           how <span class="op">=</span> <span class="st">'left'</span>, validate <span class="op">=</span> <span class="st">'many_to_one'</span>)</span>
<span id="cb118-7"><a href="#cb118-7"></a>display (trans_df.head (n<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb118-8"><a href="#cb118-8"></a>display (trans_acc_df.head (n<span class="op">=</span><span class="dv">3</span>)) </span>
<span id="cb118-9"><a href="#cb118-9"></a>display (trans_acc_dist_df.head (n<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date_x</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>district_id</th>
      <th>frequency</th>
      <th>date_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>16</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-01-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>55</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-01-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>55</td>
      <td>POPLATEK MESICNE</td>
      <td>1993-01-01</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date_x</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>...</th>
      <th>A7</th>
      <th>A8</th>
      <th>A9</th>
      <th>A10</th>
      <th>A11</th>
      <th>A12</th>
      <th>A13</th>
      <th>A14</th>
      <th>A15</th>
      <th>A16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>10</td>
      <td>1</td>
      <td>8</td>
      <td>56.9</td>
      <td>8427</td>
      <td>1.12</td>
      <td>1.54</td>
      <td>107</td>
      <td>1874</td>
      <td>1913</td>
    </tr>
    <tr>
      <th>1</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>18</td>
      <td>0</td>
      <td>9</td>
      <td>33.9</td>
      <td>8743</td>
      <td>1.88</td>
      <td>2.43</td>
      <td>111</td>
      <td>3659</td>
      <td>3894</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>18</td>
      <td>0</td>
      <td>9</td>
      <td>33.9</td>
      <td>8743</td>
      <td>1.88</td>
      <td>2.43</td>
      <td>111</td>
      <td>3659</td>
      <td>3894</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 30 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="787">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a>trans_bal_df <span class="op">=</span> trans_df.copy ()</span>
<span id="cb119-2"><a href="#cb119-2"></a></span>
<span id="cb119-3"><a href="#cb119-3"></a><span class="co">#column with amounts that affects balance positively </span></span>
<span id="cb119-4"><a href="#cb119-4"></a>trans_bal_df <span class="op">=</span> trans_bal_df.assign (pos_sum <span class="op">=</span> np.nan)</span>
<span id="cb119-5"><a href="#cb119-5"></a></span>
<span id="cb119-6"><a href="#cb119-6"></a><span class="co">#column with amounts that affects balance negatively </span></span>
<span id="cb119-7"><a href="#cb119-7"></a>trans_bal_df <span class="op">=</span> trans_bal_df.assign (neg_sum <span class="op">=</span> np.nan)</span>
<span id="cb119-8"><a href="#cb119-8"></a></span>
<span id="cb119-9"><a href="#cb119-9"></a><span class="co">#filling columns pos_sum and neg_sum based on operation type. pos_sum stands for inflows</span></span>
<span id="cb119-10"><a href="#cb119-10"></a>trans_bal_df.pos_sum <span class="op">=</span> trans_bal_df.amount.where (trans_bal_df.operation <span class="op">==</span> <span class="st">'VKLAD'</span>, trans_bal_df.pos_sum )</span>
<span id="cb119-11"><a href="#cb119-11"></a>trans_bal_df.pos_sum <span class="op">=</span> trans_bal_df.amount.where (trans_bal_df.operation <span class="op">==</span> <span class="st">'PREVOD Z UCTU'</span>, trans_bal_df.pos_sum)</span>
<span id="cb119-12"><a href="#cb119-12"></a></span>
<span id="cb119-13"><a href="#cb119-13"></a><span class="co">#neg_sum stands for outflows</span></span>
<span id="cb119-14"><a href="#cb119-14"></a>trans_bal_df.neg_sum <span class="op">=</span> trans_bal_df.amount.where (trans_bal_df.operation <span class="op">==</span> <span class="st">'VYBER'</span>, trans_bal_df.neg_sum )</span>
<span id="cb119-15"><a href="#cb119-15"></a>trans_bal_df.neg_sum <span class="op">=</span> trans_bal_df.amount.where (trans_bal_df.operation <span class="op">==</span> <span class="st">'PREVOD NA UCET'</span>, trans_bal_df.neg_sum )</span>
<span id="cb119-16"><a href="#cb119-16"></a>trans_bal_df.neg_sum <span class="op">=</span> trans_bal_df.amount.where (trans_bal_df.operation <span class="op">==</span> <span class="st">'VYBER KARTOU'</span>, trans_bal_df.neg_sum )</span>
<span id="cb119-17"><a href="#cb119-17"></a></span>
<span id="cb119-18"><a href="#cb119-18"></a>trans_bal_df [trans_bal_df [<span class="st">'operation'</span>] <span class="op">==</span> <span class="st">'VYBER'</span>].tail (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="787">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>pos_sum</th>
      <th>neg_sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1055639</th>
      <td>3489430</td>
      <td>7520</td>
      <td>1998-12-31</td>
      <td>VYDAJ</td>
      <td>VYBER</td>
      <td>67.2</td>
      <td>-11020.4</td>
      <td>SANKC. UROK</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1998</td>
      <td>NaN</td>
      <td>67.2</td>
    </tr>
    <tr>
      <th>1055676</th>
      <td>3488804</td>
      <td>7465</td>
      <td>1998-12-31</td>
      <td>VYDAJ</td>
      <td>VYBER</td>
      <td>0.8</td>
      <td>84975.2</td>
      <td>SANKC. UROK</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1998</td>
      <td>NaN</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>1055731</th>
      <td>3545165</td>
      <td>442</td>
      <td>1998-12-31</td>
      <td>VYDAJ</td>
      <td>VYBER</td>
      <td>0.6</td>
      <td>54376.5</td>
      <td>SANKC. UROK</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1998</td>
      <td>NaN</td>
      <td>0.6</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="788">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a><span class="co">#setting date as index for further visualization</span></span>
<span id="cb120-2"><a href="#cb120-2"></a>trans_bal_df.set_index (trans_bal_df [<span class="st">'date'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb120-3"><a href="#cb120-3"></a>trans_bal_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="788">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>pos_sum</th>
      <th>neg_sum</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1993-01-01</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>700.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993-01-01</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>900.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993-01-01</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>1000.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="789">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a><span class="co">#Outflows and inflows trends - years aggregation</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>inflows <span class="op">=</span> trans_bal_df[<span class="st">'pos_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb121-3"><a href="#cb121-3"></a>outflows <span class="op">=</span> trans_bal_df[<span class="st">'neg_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb121-4"><a href="#cb121-4"></a></span>
<span id="cb121-5"><a href="#cb121-5"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb121-6"><a href="#cb121-6"></a>x <span class="op">=</span> outflows.index</span>
<span id="cb121-7"><a href="#cb121-7"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb121-8"><a href="#cb121-8"></a>y1 <span class="op">=</span> <span class="bu">list</span> (inflows <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb121-9"><a href="#cb121-9"></a>y2 <span class="op">=</span> <span class="bu">list</span> (outflows <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb121-10"><a href="#cb121-10"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb121-11"><a href="#cb121-11"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Inflows'</span>)</span>
<span id="cb121-12"><a href="#cb121-12"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Outflows'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb121-13"><a href="#cb121-13"></a>ax.set_title(<span class="st">"Outflows and inflows trends (years)"</span>)</span>
<span id="cb121-14"><a href="#cb121-14"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb121-15"><a href="#cb121-15"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-82-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="790">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a><span class="co">#Outflows and inflows trends - months aggregation</span></span>
<span id="cb122-2"><a href="#cb122-2"></a>inflows <span class="op">=</span> trans_bal_df[<span class="st">'pos_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb122-3"><a href="#cb122-3"></a>outflows <span class="op">=</span> trans_bal_df[<span class="st">'neg_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb122-4"><a href="#cb122-4"></a></span>
<span id="cb122-5"><a href="#cb122-5"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb122-6"><a href="#cb122-6"></a>x <span class="op">=</span> outflows.index</span>
<span id="cb122-7"><a href="#cb122-7"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb122-8"><a href="#cb122-8"></a>y1 <span class="op">=</span> <span class="bu">list</span> (inflows <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb122-9"><a href="#cb122-9"></a>y2 <span class="op">=</span> <span class="bu">list</span> (outflows <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb122-10"><a href="#cb122-10"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb122-11"><a href="#cb122-11"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Inflows'</span>)</span>
<span id="cb122-12"><a href="#cb122-12"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Outflows'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb122-13"><a href="#cb122-13"></a>ax.set_title(<span class="st">"Outflows and inflows trends (months)"</span>)</span>
<span id="cb122-14"><a href="#cb122-14"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb122-15"><a href="#cb122-15"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="791">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a><span class="co">#Outflows and inflows trends - days aggregation</span></span>
<span id="cb123-2"><a href="#cb123-2"></a>inflows <span class="op">=</span> trans_bal_df[<span class="st">'pos_sum'</span>].resample(<span class="st">'D'</span>).<span class="bu">sum</span> ()</span>
<span id="cb123-3"><a href="#cb123-3"></a>outflows <span class="op">=</span> trans_bal_df[<span class="st">'neg_sum'</span>].resample(<span class="st">'D'</span>).<span class="bu">sum</span> ()</span>
<span id="cb123-4"><a href="#cb123-4"></a></span>
<span id="cb123-5"><a href="#cb123-5"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb123-6"><a href="#cb123-6"></a>x <span class="op">=</span> outflows.index</span>
<span id="cb123-7"><a href="#cb123-7"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb123-8"><a href="#cb123-8"></a>y1 <span class="op">=</span> <span class="bu">list</span> (inflows <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb123-9"><a href="#cb123-9"></a>y2 <span class="op">=</span> <span class="bu">list</span> (outflows <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb123-10"><a href="#cb123-10"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb123-11"><a href="#cb123-11"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Inflows'</span>)</span>
<span id="cb123-12"><a href="#cb123-12"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Outflows'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb123-13"><a href="#cb123-13"></a>ax.set_title(<span class="st">"Outflows and inflows trends (days)"</span>)</span>
<span id="cb123-14"><a href="#cb123-14"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb123-15"><a href="#cb123-15"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-84-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="792">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a><span class="co">#verifying overall balance of inflows and outflows for the whole reported period</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>display (trans_bal_df[<span class="st">'neg_sum'</span>].<span class="bu">sum</span> ())</span>
<span id="cb124-3"><a href="#cb124-3"></a>display (trans_bal_df[<span class="st">'pos_sum'</span>].<span class="bu">sum</span> ())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3030321135.799999</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>3200001735.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="793">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a><span class="co">#Outflows details investigation</span></span>
<span id="cb127-2"><a href="#cb127-2"></a></span>
<span id="cb127-3"><a href="#cb127-3"></a>trans_negflow_df <span class="op">=</span> trans_df.copy ()</span>
<span id="cb127-4"><a href="#cb127-4"></a></span>
<span id="cb127-5"><a href="#cb127-5"></a><span class="co">#column with amounts that stand for cash withdrawal </span></span>
<span id="cb127-6"><a href="#cb127-6"></a>trans_negflow_df <span class="op">=</span> trans_negflow_df.assign (cw_sum <span class="op">=</span> np.nan)</span>
<span id="cb127-7"><a href="#cb127-7"></a></span>
<span id="cb127-8"><a href="#cb127-8"></a><span class="co">#column with amounts that stand for withdrawal from credit card </span></span>
<span id="cb127-9"><a href="#cb127-9"></a>trans_negflow_df <span class="op">=</span> trans_negflow_df.assign (cwc_sum <span class="op">=</span> np.nan)</span>
<span id="cb127-10"><a href="#cb127-10"></a></span>
<span id="cb127-11"><a href="#cb127-11"></a><span class="co">#column with amounts that stand for remittance to another banks </span></span>
<span id="cb127-12"><a href="#cb127-12"></a>trans_negflow_df <span class="op">=</span> trans_negflow_df.assign (rem_sum <span class="op">=</span> np.nan)</span>
<span id="cb127-13"><a href="#cb127-13"></a></span>
<span id="cb127-14"><a href="#cb127-14"></a><span class="co">#filling columns pos_sum and neg_sum based on operation type. pos_sum stands for inflows</span></span>
<span id="cb127-15"><a href="#cb127-15"></a>trans_negflow_df.cw_sum <span class="op">=</span> trans_negflow_df.amount.where (trans_negflow_df.operation <span class="op">==</span> <span class="st">'VYBER'</span>, trans_negflow_df.cw_sum )</span>
<span id="cb127-16"><a href="#cb127-16"></a>trans_negflow_df.cwc_sum <span class="op">=</span> trans_negflow_df.amount.where (trans_negflow_df.operation <span class="op">==</span> <span class="st">'VYBER KARTOU'</span>, trans_negflow_df.cwc_sum)</span>
<span id="cb127-17"><a href="#cb127-17"></a>trans_negflow_df.rem_sum <span class="op">=</span> trans_negflow_df.amount.where (trans_negflow_df.operation <span class="op">==</span> <span class="st">'PREVOD NA UCET'</span>, trans_negflow_df.rem_sum)</span>
<span id="cb127-18"><a href="#cb127-18"></a></span>
<span id="cb127-19"><a href="#cb127-19"></a><span class="co">#trans_negflow_df [trans_negflow_df ['operation'] == 'PREVOD NA UCET'].head (n=5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="794">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1"></a><span class="co">#setting date as index for further visualization</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>trans_negflow_df.set_index (trans_negflow_df [<span class="st">'date'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb128-3"><a href="#cb128-3"></a>trans_negflow_df.head (n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="794">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>trans_id</th>
      <th>account_id</th>
      <th>date</th>
      <th>type</th>
      <th>operation</th>
      <th>amount</th>
      <th>balance</th>
      <th>k_symbol</th>
      <th>bank</th>
      <th>account</th>
      <th>tran_year</th>
      <th>cw_sum</th>
      <th>cwc_sum</th>
      <th>rem_sum</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1993-01-01</th>
      <td>695247</td>
      <td>2378</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>700.0</td>
      <td>700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993-01-01</th>
      <td>171812</td>
      <td>576</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>900.0</td>
      <td>900.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993-01-01</th>
      <td>207264</td>
      <td>704</td>
      <td>1993-01-01</td>
      <td>PRIJEM</td>
      <td>VKLAD</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1993</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="795">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a><span class="co">#plotting results outflows decomposition (years)</span></span>
<span id="cb129-2"><a href="#cb129-2"></a>cashw <span class="op">=</span> trans_negflow_df[<span class="st">'cw_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb129-3"><a href="#cb129-3"></a>cashw_card <span class="op">=</span> trans_negflow_df[<span class="st">'cwc_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb129-4"><a href="#cb129-4"></a>remit <span class="op">=</span> trans_negflow_df[<span class="st">'rem_sum'</span>].resample(<span class="st">'Y'</span>).<span class="bu">sum</span> ()</span>
<span id="cb129-5"><a href="#cb129-5"></a></span>
<span id="cb129-6"><a href="#cb129-6"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb129-7"><a href="#cb129-7"></a>x <span class="op">=</span> cashw.index</span>
<span id="cb129-8"><a href="#cb129-8"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb129-9"><a href="#cb129-9"></a>y1 <span class="op">=</span> <span class="bu">list</span> (cashw <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb129-10"><a href="#cb129-10"></a>y2 <span class="op">=</span> <span class="bu">list</span> (remit <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb129-11"><a href="#cb129-11"></a>y3 <span class="op">=</span> <span class="bu">list</span> (cashw_card <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb129-12"><a href="#cb129-12"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb129-13"><a href="#cb129-13"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Cash withdrawal'</span>)</span>
<span id="cb129-14"><a href="#cb129-14"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Remittance to another banks'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb129-15"><a href="#cb129-15"></a>ax.plot(x, y3, label <span class="op">=</span> <span class="st">'Cash withdrawal from credit card'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb129-16"><a href="#cb129-16"></a>ax.set_title(<span class="st">"Outflows decomposition (years)"</span>)</span>
<span id="cb129-17"><a href="#cb129-17"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb129-18"><a href="#cb129-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-88-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="796">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1"></a><span class="co">#plotting results outflows decomposition (months)</span></span>
<span id="cb130-2"><a href="#cb130-2"></a>cashw <span class="op">=</span> trans_negflow_df[<span class="st">'cw_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb130-3"><a href="#cb130-3"></a>cashw_card <span class="op">=</span> trans_negflow_df[<span class="st">'cwc_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb130-4"><a href="#cb130-4"></a>remit <span class="op">=</span> trans_negflow_df[<span class="st">'rem_sum'</span>].resample(<span class="st">'M'</span>).<span class="bu">sum</span> ()</span>
<span id="cb130-5"><a href="#cb130-5"></a></span>
<span id="cb130-6"><a href="#cb130-6"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb130-7"><a href="#cb130-7"></a>x <span class="op">=</span> cashw.index</span>
<span id="cb130-8"><a href="#cb130-8"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb130-9"><a href="#cb130-9"></a>y1 <span class="op">=</span> <span class="bu">list</span> (cashw <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb130-10"><a href="#cb130-10"></a>y2 <span class="op">=</span> <span class="bu">list</span> (remit <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb130-11"><a href="#cb130-11"></a>y3 <span class="op">=</span> <span class="bu">list</span> (cashw_card <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb130-12"><a href="#cb130-12"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb130-13"><a href="#cb130-13"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Cash withdrawal'</span>)</span>
<span id="cb130-14"><a href="#cb130-14"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Remittance to another banks'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb130-15"><a href="#cb130-15"></a>ax.plot(x, y3, label <span class="op">=</span> <span class="st">'Cash withdrawal from credit card'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb130-16"><a href="#cb130-16"></a>ax.set_title(<span class="st">"Outflows decomposition (months)"</span>)</span>
<span id="cb130-17"><a href="#cb130-17"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb130-18"><a href="#cb130-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-89-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="797">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a>pd.DataFrame (cashw<span class="op">/</span><span class="dv">1000000</span>).head (n<span class="op">=</span><span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="797">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>cw_sum</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1993-01-31</th>
      <td>0.034700</td>
    </tr>
    <tr>
      <th>1993-02-28</th>
      <td>0.271815</td>
    </tr>
    <tr>
      <th>1993-03-31</th>
      <td>0.852493</td>
    </tr>
    <tr>
      <th>1993-04-30</th>
      <td>2.026936</td>
    </tr>
    <tr>
      <th>1993-05-31</th>
      <td>3.897119</td>
    </tr>
    <tr>
      <th>1993-06-30</th>
      <td>7.180022</td>
    </tr>
    <tr>
      <th>1993-07-31</th>
      <td>6.676697</td>
    </tr>
    <tr>
      <th>1993-08-31</th>
      <td>7.994952</td>
    </tr>
    <tr>
      <th>1993-09-30</th>
      <td>8.471902</td>
    </tr>
    <tr>
      <th>1993-10-31</th>
      <td>10.318828</td>
    </tr>
    <tr>
      <th>1993-11-30</th>
      <td>10.782028</td>
    </tr>
    <tr>
      <th>1993-12-31</th>
      <td>15.199389</td>
    </tr>
    <tr>
      <th>1994-01-31</th>
      <td>21.031592</td>
    </tr>
    <tr>
      <th>1994-02-28</th>
      <td>9.571364</td>
    </tr>
    <tr>
      <th>1994-03-31</th>
      <td>13.809816</td>
    </tr>
    <tr>
      <th>1994-04-30</th>
      <td>13.718473</td>
    </tr>
    <tr>
      <th>1994-05-31</th>
      <td>15.815229</td>
    </tr>
    <tr>
      <th>1994-06-30</th>
      <td>25.609627</td>
    </tr>
    <tr>
      <th>1994-07-31</th>
      <td>15.466124</td>
    </tr>
    <tr>
      <th>1994-08-31</th>
      <td>15.846305</td>
    </tr>
    <tr>
      <th>1994-09-30</th>
      <td>16.992539</td>
    </tr>
    <tr>
      <th>1994-10-31</th>
      <td>17.482733</td>
    </tr>
    <tr>
      <th>1994-11-30</th>
      <td>17.032683</td>
    </tr>
    <tr>
      <th>1994-12-31</th>
      <td>23.894643</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Peaks of cashwithdrawal in Jan (rarely Feb) and June.</p>
<div class="cell" data-execution_count="798">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1"></a><span class="co">#plotting results outflows decomposition (days)</span></span>
<span id="cb132-2"><a href="#cb132-2"></a>cashw <span class="op">=</span> trans_negflow_df[<span class="st">'cw_sum'</span>].resample(<span class="st">'D'</span>).<span class="bu">sum</span> ()</span>
<span id="cb132-3"><a href="#cb132-3"></a>cashw_card <span class="op">=</span> trans_negflow_df[<span class="st">'cwc_sum'</span>].resample(<span class="st">'D'</span>).<span class="bu">sum</span> ()</span>
<span id="cb132-4"><a href="#cb132-4"></a>remit <span class="op">=</span> trans_negflow_df[<span class="st">'rem_sum'</span>].resample(<span class="st">'D'</span>).<span class="bu">sum</span> ()</span>
<span id="cb132-5"><a href="#cb132-5"></a></span>
<span id="cb132-6"><a href="#cb132-6"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb132-7"><a href="#cb132-7"></a>x <span class="op">=</span> cashw.index</span>
<span id="cb132-8"><a href="#cb132-8"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">15</span>,<span class="dv">6</span>))</span>
<span id="cb132-9"><a href="#cb132-9"></a>y1 <span class="op">=</span> <span class="bu">list</span> (cashw <span class="op">/</span> <span class="dv">1000000</span>) </span>
<span id="cb132-10"><a href="#cb132-10"></a>y2 <span class="op">=</span> <span class="bu">list</span> (remit <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb132-11"><a href="#cb132-11"></a>y3 <span class="op">=</span> <span class="bu">list</span> (cashw_card <span class="op">/</span> <span class="dv">1000000</span>)</span>
<span id="cb132-12"><a href="#cb132-12"></a>ax.set_ylabel(<span class="st">'Millions'</span>)</span>
<span id="cb132-13"><a href="#cb132-13"></a>ax.plot(x, y1, label <span class="op">=</span> <span class="st">'Cash withdrawal'</span>)</span>
<span id="cb132-14"><a href="#cb132-14"></a>ax.plot(x, y2, label <span class="op">=</span> <span class="st">'Remittance to another banks'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb132-15"><a href="#cb132-15"></a>ax.plot(x, y3, label <span class="op">=</span> <span class="st">'Cash withdrawal from credit card'</span> )<span class="co">#, figsize = (8,8))</span></span>
<span id="cb132-16"><a href="#cb132-16"></a>ax.set_title(<span class="st">"Outflows decomposition (days)"</span>)</span>
<span id="cb132-17"><a href="#cb132-17"></a>plt.legend (loc <span class="op">=</span> <span class="st">'best'</span>)</span>
<span id="cb132-18"><a href="#cb132-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Czech-banking-customer-trans-analysis_files/figure-html/cell-91-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="business-questions-part-4-transactions-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="business-questions-part-4-transactions-conclusion">Business questions part #4 (transactions) conclusion:</h3>
<ul>
<li>Transaction types distribution in the dataset: traditionally cash withdrawal is the most popular operation (41%), 19% for remittance from another banks, 17% for interest credit, the least used is cash withdrawal from credit card which is reasonable as this transaction is usually chargeable for customers.<br>
</li>
<li>Transactions distribution within given period (1993-1998) mostly the same. Despite the fact that number of transaction for remittance to another bank is bigger than number of collection from another banks (in some years more than 2 times), overall sum within year is smaller and the balance is positive.</li>
<li>Inflows prevail over outflows during reported period (year, months) although in some specific days it is different.</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>